<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Human population • IBMPopSim</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Human population">
<meta property="og:description" content="IBMPopSim">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">IBMPopSim</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/IBMPopSim-description.html">IBMPopSim description</a>
    </li>
    <li>
      <a href="../articles/IBMPopSim-human_pop.html">Human population</a>
    </li>
    <li>
      <a href="../articles/IBMPopSim-human_popIMD.html">Human population with swap</a>
    </li>
    <li>
      <a href="../articles/IBMPopSim-interaction.html">Population with genetically variable traits</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/DaphneGiorgi/IBMPopSim/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="IBMPopSim-human_pop_files/header-attrs-2.1/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Human population</h1>
                        <h4 class="author">Daphné Giorgi</h4>
                        <h4 class="author">Sarah Kaakaï</h4>
                        <h4 class="author">Vincent Lemaire</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/DaphneGiorgi/IBMPopSim/blob/master/vignettes/IBMPopSim-human_pop.Rmd"><code>vignettes/IBMPopSim-human_pop.Rmd</code></a></small>
      <div class="hidden name"><code>IBMPopSim-human_pop.Rmd</code></div>

    </div>

    
    
<p>This document provides an first simple example of usage of the package IBMPopSim, for simulating a human population with only birth and death events.</p>
<div id="example-description" class="section level1">
<h1 class="hasAnchor">
<a href="#example-description" class="anchor"></a>Example description</h1>
<p>We consider a population where individuals are marked by their age and gender (male or female).</p>
<p>Two events can occur to an individual, who can give birth (only if female) or die. Birth and death intensities depend on the individuals’ age and gender, but stay constant over time. In this toy model, birth and death intensities are fitted to England and Wales 2014 birth and death rates (source: Office for National Statistics).</p>
</div>
<div id="population-creation" class="section level1">
<h1 class="hasAnchor">
<a href="#population-creation" class="anchor"></a>Population creation</h1>
<p>The inital population is a 100 000 individuals population sampled from England and Wales’ 2014 age pyramid distribution (source: Office for National Statistics).</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">EW_pop_14</span>)</pre></body></html></div>
<pre><code>## List of 3
##  $ age_pyramid:'data.frame': 232 obs. of  3 variables:
##   ..$ age  : Factor w/ 116 levels "0 - 1","1 - 2",..: 1 1 2 2 3 3 4 4 5 5 ...
##   ..$ male : logi [1:232] FALSE TRUE FALSE TRUE FALSE TRUE ...
##   ..$ value: num [1:232] 323863 340320 332357 350346 344972 ...
##  $ rates      :List of 3
##   ..$ birth       :'data.frame': 7 obs. of  2 variables:
##   .. ..$ age  : num [1:7] 15 20 25 30 35 40 45
##   .. ..$ value: num [1:7] 0.0156 0.0601 0.1008 0.1104 0.0645 ...
##   ..$ death_male  :'data.frame': 91 obs. of  2 variables:
##   .. ..$ age  : int [1:91] 0 1 2 3 4 5 6 7 8 9 ...
##   .. ..$ value: num [1:91] 4.03e-03 3.60e-04 1.52e-04 1.35e-04 7.73e-05 ...
##   ..$ death_female:'data.frame': 91 obs. of  2 variables:
##   .. ..$ age  : int [1:91] 0 1 2 3 4 5 6 7 8 9 ...
##   .. ..$ value: num [1:91] 0.003634 0.000226 0.000139 0.000121 0.000078 ...
##  $ sample     :'data.frame': 100000 obs. of  3 variables:
##   ..$ birth: num [1:100000] -107 -107 -105 -104 -104 ...
##   ..$ death: num [1:100000] NA NA NA NA NA NA NA NA NA NA ...
##   ..$ male : logi [1:100000] FALSE FALSE TRUE FALSE FALSE FALSE ...</code></pre>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_population.html">plot_population</a></span>(<span class="no">EW_pop_14</span>$<span class="no">sample</span>)</pre></body></html></div>
<p><img src="IBMPopSim-human_pop_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
</div>
<div id="model-parameters" class="section level1">
<h1 class="hasAnchor">
<a href="#model-parameters" class="anchor"></a>Model parameters</h1>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">params</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="no">EW_pop_14</span>$<span class="no">rates</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
        <span class="st">"p_male"</span> <span class="kw">=</span> <span class="fl">0.512</span>, <span class="co"># probability to give birth to a male. </span>
        <span class="st">"birth_rate"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/stepfun.html">stepfun</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">birth</span>[,<span class="st">"age"</span>], <span class="kw">y</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="no">birth</span>[,<span class="st">"value"</span>])),
        <span class="st">"death_male"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/stepfun.html">stepfun</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">death_male</span>[,<span class="st">"age"</span>], <span class="kw">y</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="no">death_male</span>[,<span class="st">"value"</span>])),
        <span class="st">"death_female"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/stepfun.html">stepfun</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">death_female</span>[,<span class="st">"age"</span>], <span class="kw">y</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="no">death_female</span>[,<span class="st">"value"</span>]))
    )
)</pre></body></html></div>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">lbl</span> <span class="kw">=</span> <span class="fu">labs</span>(<span class="kw">x</span><span class="kw">=</span><span class="st">"Age"</span>, <span class="kw">y</span><span class="kw">=</span><span class="st">"Intensity"</span>)
<span class="no">thm</span> <span class="kw">=</span> <span class="fu">theme</span>(<span class="kw">plot.title</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0.5</span>))
<span class="fu">grid.arrange</span>(
    <span class="fu">autoplot</span>(<span class="no">params</span>$<span class="no">birth</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="kw">NULL</span>) + <span class="fu">ggtitle</span>(<span class="st">"Birth intensity"</span>) + <span class="no">lbl</span>,
    <span class="fu">autoplot</span>(<span class="no">params</span>$<span class="no">death_male</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="kw">NULL</span>) + <span class="fu">ggtitle</span>(<span class="st">"Death male intensity"</span>) + <span class="no">lbl</span>,
    <span class="fu">autoplot</span>(<span class="no">params</span>$<span class="no">death_female</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="kw">NULL</span>) + <span class="fu">ggtitle</span>(<span class="st">"Death female intensity"</span>) + <span class="no">lbl</span>
)</pre></body></html></div>
<p><img src="IBMPopSim-human_pop_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div id="events-creation" class="section level1">
<h1 class="hasAnchor">
<a href="#events-creation" class="anchor"></a>Events creation</h1>
<p>There are 2 possible events :</p>
<ul>
<li>Birth</li>
<li>Death</li>
</ul>
<p>Both event intensities are of type <code>individual</code>, which means that the intensity at which an individual gives birth or dies only depends on his age and characteristics, and not on other individuals characteristics (in other word, there are no interactions).</p>
<p>The birth and the death intensities are bounded step functions, which are constant over time.</p>
<p><strong>Birth event creation</strong></p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">birth_event</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mk_event_individual.html">mk_event_individual</a></span>(
    <span class="kw">type</span> <span class="kw">=</span> <span class="st">"birth"</span>,
    <span class="kw">intensity_code</span> <span class="kw">=</span> <span class="st">"if (I.male) result = 0; else result = birth_rate(age(I, t));"</span>,
    <span class="kw">kernel_code</span> <span class="kw">=</span> <span class="st">"newI.male = CUnif(0, 1) &lt; p_male;"</span> <span class="co"># The gender of the newborn is male with probability p_male</span>
)</pre></body></html></div>
<p><strong>Death event creation</strong></p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">death_event</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mk_event_individual.html">mk_event_individual</a></span>(
    <span class="kw">type</span> <span class="kw">=</span> <span class="st">"death"</span>,
    <span class="kw">intensity_code</span> <span class="kw">=</span> <span class="st">"result = (I.male) ? death_male(age(I, t)) : death_female(age(I, t));"</span>
)</pre></body></html></div>
</div>
<div id="model-creation-and-simulation" class="section level1">
<h1 class="hasAnchor">
<a href="#model-creation-and-simulation" class="anchor"></a>Model creation and simulation</h1>
<div id="model-creation" class="section level2">
<h2 class="hasAnchor">
<a href="#model-creation" class="anchor"></a>Model creation</h2>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">model</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mk_model.html">mk_model</a></span>(
    <span class="kw">characteristics</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_characteristics.html">get_characteristics</a></span>(<span class="no">EW_pop_14</span>$<span class="no">sample</span>),<span class="co"># Characteristics names ant type</span>
    <span class="kw">events</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">birth_event</span>, <span class="no">death_event</span>), <span class="co"># Model events</span>
    <span class="kw">parameters</span> <span class="kw">=</span> <span class="no">params</span> <span class="co"># Model parameters </span>
)
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">model</span>)</pre></body></html></div>
<pre><code>## Events:
## #1: individual event of type birth
## #2: individual event of type death
## --------------------------------------- 
## Individual description:
## names:  birth death male 
## R types:  double double logical 
## C types:  double double bool
## --------------------------------------- 
## R parameters available in C++ code:
## names:  p_male birth_rate death_male death_female 
## R types:  double closure closure closure 
## C types:  double function_x function_x function_x</code></pre>
<p><strong>Computation of event intensity bounds</strong> (needed for acceptance/rejection algorithm)</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">birth_max</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">params</span>$<span class="no">birth</span>)
<span class="no">death_max</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="no">params</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">death_male</span>), <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">death_female</span>)))</pre></body></html></div>
</div>
<div id="simulation-of-the-population-over-50-years" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation-of-the-population-over-50-years" class="anchor"></a>Simulation of the population over 50 years</h2>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">sim_out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/popsim.html">popsim</a></span>(<span class="kw">model</span> <span class="kw">=</span> <span class="no">model</span>,
    <span class="kw">population</span> <span class="kw">=</span> <span class="no">EW_pop_14</span>$<span class="no">sample</span>, <span class="co"># Initial population </span>
    <span class="kw">events_bounds</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'birth'</span> <span class="kw">=</span> <span class="no">birth_max</span>, <span class="st">'death'</span> <span class="kw">=</span> <span class="no">death_max</span>), <span class="co"># Vector of</span>
                    <span class="co">#intensity bounds, with name corresponding to events name. </span>
    <span class="kw">parameters</span> <span class="kw">=</span> <span class="no">params</span>,
    <span class="kw">time</span> <span class="kw">=</span> <span class="fl">50</span>,
    <span class="kw">age_max</span> <span class="kw">=</span> <span class="fl">120</span>,
    <span class="kw">multithreading</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<pre><code>## [1] "birth" "death"
## [1] "birth" "death"
## [1] "birth" "death"
## Simulation on  [0, 50]</code></pre>
<p><strong>Simulation logs</strong></p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">sim_out</span>$<span class="no">logs</span></pre></body></html></div>
<pre><code>##         proposed_events        effective_events        cleanall_counter 
##            1.685277e+06            1.142270e+05            6.000000e+00 
## duration_main_algorithm 
##            9.668500e-02</code></pre>
<p>The ratio of accepted events is</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">sim_out</span>$<span class="no">logs</span><span class="kw">[[</span><span class="st">"effective_events"</span>]] / <span class="no">sim_out</span>$<span class="no">logs</span><span class="kw">[[</span><span class="st">"proposed_events"</span>]]</pre></body></html></div>
<pre><code>## [1] 0.06777936</code></pre>
<p><strong>Outputs</strong></p>
<p><code>sim_out$population</code> is a data frame composed of all individuals who lived in the population over the period [0,50] (individuals in the initial population and born during the simulation period).<br>
Each line corresponds to an individual, with his date of birth, date of death (<code>NA</code> if still alive at the end of the simulation) and gender.</p>
<p>The function <code>age_pyramid</code>computes the age pyramid of a population data frame at a given time.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">pyr_init</span> <span class="kw">=</span> <span class="fu"><a href="../reference/age_pyramid.html">age_pyramid</a></span>(<span class="no">sim_out</span>$<span class="no">population</span>, <span class="kw">time</span> <span class="kw">=</span> <span class="fl">0</span>,<span class="kw">ages</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>:<span class="fl">100</span>,<span class="fl">Inf</span>))
<span class="no">pyr</span> <span class="kw">=</span> <span class="fu"><a href="../reference/age_pyramid.html">age_pyramid</a></span>(<span class="no">sim_out</span>$<span class="no">population</span>, <span class="kw">time</span> <span class="kw">=</span> <span class="fl">50</span>, <span class="kw">ages</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>:<span class="fl">100</span>,<span class="fl">Inf</span>))
<span class="fu">grid.arrange</span>(<span class="fu"><a href="../reference/plot_pyramid.html">plot_pyramid</a></span>(<span class="no">pyr_init</span>),
             <span class="fu"><a href="../reference/plot_pyramid.html">plot_pyramid</a></span>(<span class="no">pyr</span>,<span class="kw">value_breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>,<span class="fl">800</span>,<span class="fl">200</span>)))</pre></body></html></div>
<p><img src="IBMPopSim-human_pop_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>Female age pyramid</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_pyramid.html">plot_pyramid</a></span>(<span class="no">pyr</span>[<span class="no">pyr</span>$<span class="no">male</span><span class="kw">==</span><span class="fl">FALSE</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"age"</span>,<span class="st">"value"</span>)], <span class="kw">age_breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1</span>,<span class="fl">101</span>,<span class="fl">5</span>)))</pre></body></html></div>
<p><img src="IBMPopSim-human_pop_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p><code>age_pyramids</code> returns a data frame representing the population age pyramids at different times.</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r">#pyrs = age_pyramids(sim_out$population, time = 1:50)</pre></body></html></div>
<div class="sourceCode" id="cb20"><html><body><pre class="r">#library(gganimate)</pre></body></html></div>
<div class="sourceCode" id="cb21"><html><body><pre class="r">#plot_pyramid(pyrs) + transition_time(time) + labs(title = "Time: {frame_time}")</pre></body></html></div>
</div>
</div>
<div id="different-simulations-with-the-same-model" class="section level1">
<h1 class="hasAnchor">
<a href="#different-simulations-with-the-same-model" class="anchor"></a>Different simulations with the same model</h1>
<div id="change-initial-population" class="section level2">
<h2 class="hasAnchor">
<a href="#change-initial-population" class="anchor"></a>Change initial population</h2>
<p>The population evolution can be simulated starting from a different initial population, without having to recompile the model.</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="no">pop_sample_1e6</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/popsample.html">popsample</a></span>(<span class="no">EW_pop_14</span>$<span class="no">age_pyramid</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">1e6</span>)</pre></body></html></div>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_population.html">plot_population</a></span>(<span class="no">pop_sample_1e6</span>)</pre></body></html></div>
<p><img src="IBMPopSim-human_pop_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">sim_out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/popsim.html">popsim</a></span>(<span class="kw">model</span> <span class="kw">=</span> <span class="no">model</span>,
    <span class="kw">population</span> <span class="kw">=</span> <span class="no">pop_sample_1e6</span>, <span class="co"># Initial population </span>
    <span class="kw">events_bounds</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'birth'</span> <span class="kw">=</span> <span class="no">birth_max</span>, <span class="st">'death'</span> <span class="kw">=</span> <span class="no">death_max</span>), <span class="co"># Vector of</span>
                    <span class="co">#intensity bounds, with name corresponding to events name. </span>
    <span class="kw">parameters</span> <span class="kw">=</span> <span class="no">params</span>,
    <span class="kw">time</span> <span class="kw">=</span> <span class="fl">50</span>,
    <span class="kw">age_max</span> <span class="kw">=</span> <span class="fl">120</span>,
    <span class="kw">multithreading</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<pre><code>## [1] "birth" "death"
## [1] "birth" "death"
## [1] "birth" "death"
## Simulation on  [0, 50]</code></pre>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="no">sim_out</span>$<span class="no">logs</span></pre></body></html></div>
<pre><code>##         proposed_events        effective_events        cleanall_counter 
##            1.678573e+07            1.134368e+06            6.000000e+00 
## duration_main_algorithm 
##            1.293690e+00</code></pre>
</div>
<div id="modify-an-intensity" class="section level2">
<h2 class="hasAnchor">
<a href="#modify-an-intensity" class="anchor"></a>Modify an intensity</h2>
<p>Events intensities and/or kernels can be modified by changing the parameters value.</p>
<p>In the first toy model, mortality rates are assumed to be constant after age 90, with a maximum age of 120 in the population. This leads to a significant increase in the number of individuals of age over 100, even though mortality rates don’t change over time in this model.</p>
<p>A more realistic assumption is to assume that mortality rates increases after age 90, by changing the model parameters <code>death_male</code> and <code>death_female</code>. The two step functions are replaced by functions of type <code>piecewise_x</code>, composed of a step function before age 90 and a linear function after for older ages.</p>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="no">death_male_90</span> <span class="kw">&lt;-</span> <span class="no">params</span>$<span class="no">death_male</span>
<span class="no">old_death_male</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/linfun.html">linfun</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">89</span>,<span class="fl">120</span>), <span class="kw">y</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu">death_male_90</span>(<span class="fl">89</span>), <span class="fl">0.7</span>))
<span class="no">params</span>$<span class="no">death_male</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/piecewise_x.html">piecewise_x</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">89</span>), <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">death_male_90</span>,<span class="no">old_death_male</span>))

<span class="no">death_female_90</span> <span class="kw">&lt;-</span> <span class="no">params</span>$<span class="no">death_female</span>
<span class="no">old_death_female</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/linfun.html">linfun</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">89</span>,<span class="fl">120</span>), <span class="kw">y</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu">death_female_90</span>(<span class="fl">89</span>), <span class="fl">0.7</span>))
<span class="no">params</span>$<span class="no">death_female</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/piecewise_x.html">piecewise_x</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">89</span>), <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">death_female_90</span>,<span class="no">old_death_female</span>))</pre></body></html></div>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fl">0</span>:<span class="fl">120</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">params</span>$<span class="fu">death_female</span>(<span class="fl">0</span>:<span class="fl">120</span>)),<span class="kw">type</span><span class="kw">=</span><span class="st">"l"</span>,<span class="kw">main</span><span class="kw">=</span><span class="st">"log female death rates"</span>,<span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"rates"</span>)</pre></body></html></div>
<p><img src="IBMPopSim-human_pop_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
<p>Once the new model parameters have be defined, the event bounds must be updated.</p>
<div class="sourceCode" id="cb30"><html><body><pre class="r"><span class="no">sim_out_lin</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/popsim.html">popsim</a></span>(<span class="kw">model</span> <span class="kw">=</span> <span class="no">model</span>,
                  <span class="kw">population</span> <span class="kw">=</span> <span class="no">pop_sample_1e6</span>, <span class="co"># Initial population </span>
                  <span class="kw">events_bounds</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'birth'</span> <span class="kw">=</span> <span class="no">birth_max</span>, <span class="st">'death'</span> <span class="kw">=</span> <span class="fl">0.7</span>), <span class="co"># New death intensity bound is 0.7</span>
                  <span class="kw">parameters</span> <span class="kw">=</span> <span class="no">params</span>,
                  <span class="kw">time</span> <span class="kw">=</span> <span class="fl">50</span>,
                  <span class="kw">age_max</span> <span class="kw">=</span> <span class="fl">120</span>)</pre></body></html></div>
<pre><code>## [1] "birth" "death"
## [1] "birth" "death"
## [1] "birth" "death"
## Simulation on  [0, 50]</code></pre>
<p>The modification of the shape of mortality rates for ages over 90 generates a decrease of around 10% in the individuals aged over 100 after 50 years of simulation.</p>
<div class="sourceCode" id="cb32"><html><body><pre class="r"><span class="no">pop_size_90plus_const</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="fu"><a href="../reference/population_alive.html">population_alive</a></span>(<span class="no">sim_out</span>$<span class="no">population</span>,<span class="kw">t</span> <span class="kw">=</span> <span class="fl">50</span>,<span class="kw">a1</span><span class="kw">=</span><span class="fl">90</span>))
<span class="no">pop_size_90plus_lin</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="fu"><a href="../reference/population_alive.html">population_alive</a></span>(<span class="no">sim_out_lin</span>$<span class="no">population</span>,<span class="kw">t</span> <span class="kw">=</span> <span class="fl">50</span>,<span class="kw">a1</span><span class="kw">=</span><span class="fl">90</span>))
(<span class="no">pop_size_90plus_const</span>-<span class="no">pop_size_90plus_lin</span>)/<span class="no">pop_size_90plus_const</span>*<span class="fl">100</span></pre></body></html></div>
<pre><code>## [1] 5.02529</code></pre>
</div>
<div id="deactivate-an-event" class="section level2">
<h2 class="hasAnchor">
<a href="#deactivate-an-event" class="anchor"></a>Deactivate an event</h2>
<div class="sourceCode" id="cb34"><html><body><pre class="r"><span class="no">sim_out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/popsim.html">popsim</a></span>(<span class="kw">model</span> <span class="kw">=</span> <span class="no">model</span>,
       <span class="kw">population</span> <span class="kw">=</span> <span class="no">EW_pop_14</span>$<span class="no">sample</span>,
       <span class="kw">events_bounds</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'birth'</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="st">'death'</span> <span class="kw">=</span> <span class="no">death_max</span>),
       <span class="kw">parameters</span> <span class="kw">=</span> <span class="no">params</span>,
       <span class="kw">age_max</span> <span class="kw">=</span> <span class="fl">130</span>,
       <span class="kw">time</span> <span class="kw">=</span> <span class="fl">50</span>)</pre></body></html></div>
<pre><code>## [1] "birth" "death"
## [1] "birth" "death"
## [1] "birth" "death"
## [1] "event birth is deactivated"
## Simulation on  [0, 50]</code></pre>
<p>The age pyramid can be directly plotted from the population data frame with <code>plot_population</code></p>
<div class="sourceCode" id="cb36"><html><body><pre class="r"><span class="fu">grid.arrange</span>(
    <span class="fu"><a href="../reference/plot_population.html">plot_population</a></span>(<span class="no">sim_out</span>$<span class="no">population</span>, <span class="kw">time</span><span class="kw">=</span><span class="fl">0</span>, <span class="kw">ages</span><span class="kw">=</span> <span class="fl">0</span>:<span class="fl">105</span>),
    <span class="fu"><a href="../reference/plot_population.html">plot_population</a></span>(<span class="no">sim_out</span>$<span class="no">population</span>, <span class="kw">time</span><span class="kw">=</span><span class="fl">20</span>, <span class="kw">ages</span><span class="kw">=</span> <span class="fl">0</span>:<span class="fl">105</span>)
    )</pre></body></html></div>
<p><img src="IBMPopSim-human_pop_files/figure-html/unnamed-chunk-26-1.png" width="700"></p>
<div class="sourceCode" id="cb37"><html><body><pre class="r"><span class="fu"><a href="../reference/age_pyramid.html">age_pyramid</a></span>(<span class="no">sim_out</span>$<span class="no">population</span>, <span class="kw">ages</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">70</span>,<span class="fl">90</span>,<span class="fl">10</span>), <span class="kw">time</span> <span class="kw">=</span> <span class="fl">30</span>)</pre></body></html></div>
<pre><code>##       age  male value
## 1 70 - 80 FALSE  5795
## 2 70 - 80  TRUE  5102
## 3 80 - 90 FALSE  3622
## 4 80 - 90  TRUE  2763</code></pre>
</div>
</div>
<div id="addition-of-number-of-children-characteristic" class="section level1">
<h1 class="hasAnchor">
<a href="#addition-of-number-of-children-characteristic" class="anchor"></a>Addition of “number of children” characteristic</h1>
<p>The number of children of each women in the population can be recorded by adding a new characteristics (here named <code>children</code>) and changing the birth event kernel code.</p>
<div class="sourceCode" id="cb39"><html><body><pre class="r"><span class="no">chi</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_characteristics.html">get_characteristics</a></span>(<span class="no">EW_pop_14</span>$<span class="no">sample</span>)</pre></body></html></div>
<div class="sourceCode" id="cb40"><html><body><pre class="r"><span class="no">chi</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">chi</span>, <span class="st">'children'</span> <span class="kw">=</span> <span class="st">'int'</span>) <span class="co"># Addition  of characteristics children in the model</span>
<span class="no">chi</span></pre></body></html></div>
<pre><code>##     male children 
##   "bool"    "int"</code></pre>
<p><strong>Birth event with children count</strong></p>
<div class="sourceCode" id="cb42"><html><body><pre class="r"><span class="no">new_birth_event</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mk_event_individual.html">mk_event_individual</a></span>(
    <span class="kw">type</span> <span class="kw">=</span> <span class="st">"birth"</span>, <span class="kw">name</span> <span class="kw">=</span><span class="st">"birth_child"</span>,
    <span class="kw">intensity_code</span> <span class="kw">=</span> <span class="st">"if (I.male) result = 0; else result = birth_rate(age(I, t));"</span>,
    <span class="kw">kernel_code</span> <span class="kw">=</span> <span class="st">" newI.male = CUnif(0, 1) &lt; p_male;
                    newI.children = 0;
                    I.children += 1;"</span> <span class="co">#When event occur, I.children is increased of one to count the number of children of I </span>
)</pre></body></html></div>
<div class="sourceCode" id="cb43"><html><body><pre class="r"><span class="no">model_child</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mk_model.html">mk_model</a></span>(
    <span class="kw">characteristics</span> <span class="kw">=</span> <span class="no">chi</span>,
    <span class="kw">events</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">new_birth_event</span>, <span class="no">death_event</span>),
    <span class="kw">parameters</span> <span class="kw">=</span> <span class="no">params</span>
)
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">model_child</span>)</pre></body></html></div>
<pre><code>## Events:
## #1: individual event of type birth
## #2: individual event of type death
## --------------------------------------- 
## Individual description:
## names:  birth death male children 
## R types:  double double logical integer 
## C types:  double double bool int
## --------------------------------------- 
## R parameters available in C++ code:
## names:  p_male birth_rate death_male death_female 
## R types:  double closure closure closure 
## C types:  double function_x function_x function_x</code></pre>
<div class="sourceCode" id="cb45"><html><body><pre class="r"><span class="no">init_pop</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">EW_pop_14</span>$<span class="no">sample</span>, <span class="st">"children"</span><span class="kw">=</span><span class="fl">0</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">init_pop</span>)</pre></body></html></div>
<pre><code>##       birth death  male children
## 1 -106.9055    NA FALSE        0
## 2 -106.8303    NA FALSE        0
## 3 -104.5097    NA  TRUE        0
## 4 -104.2218    NA FALSE        0
## 5 -103.5225    NA FALSE        0
## 6 -103.3644    NA FALSE        0</code></pre>
<div class="sourceCode" id="cb47"><html><body><pre class="r"><span class="no">sim_out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/popsim.html">popsim</a></span>(<span class="no">model_child</span>,
       <span class="kw">population</span> <span class="kw">=</span> <span class="no">init_pop</span>,
       <span class="kw">events_bounds</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'birth_child'</span> <span class="kw">=</span> <span class="no">birth_max</span>, <span class="st">'death'</span> <span class="kw">=</span> <span class="no">death_max</span>),
       <span class="kw">parameters</span> <span class="kw">=</span> <span class="no">params</span>,
       <span class="kw">time</span> <span class="kw">=</span> <span class="fl">100</span>,
       <span class="kw">age_max</span> <span class="kw">=</span> <span class="fl">120</span>,
       <span class="kw">multithreading</span><span class="kw">=</span><span class="fl">TRUE</span>)</pre></body></html></div>
<pre><code>## [1] "birth_child" "death"      
## [1] "birth_child" "death"      
## [1] "birth_child" "death"      
## Simulation on  [0, 100]</code></pre>
<div class="sourceCode" id="cb49"><html><body><pre class="r"><span class="co"># Females of age over 50 alive at time 100:</span>
<span class="no">pop_female_time</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/population_alive.html">population_alive</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">sim_out</span>$<span class="no">population</span>, <span class="no">male</span> <span class="kw">==</span> <span class="no">F</span>), <span class="kw">t</span><span class="kw">=</span> <span class="fl">100</span>, <span class="kw">a1</span><span class="kw">=</span> <span class="fl">50</span>)
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">pop_female_time</span>)[<span class="fl">1</span>]<span class="co"># Number of females over 100</span></pre></body></html></div>
<pre><code>## [1] 16818</code></pre>
<div class="sourceCode" id="cb51"><html><body><pre class="r"><span class="fu">ggplot</span>(<span class="no">pop_female_time</span>, <span class="fu">aes</span>(<span class="kw">x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">children</span>)))+
<span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="kw">y</span> <span class="kw">=</span> (<span class="no">..count..</span>)/<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">..count..</span>)))+
<span class="fu">scale_y_continuous</span>(<span class="kw">labels</span><span class="kw">=</span><span class="kw pkg">scales</span><span class="kw ns">::</span><span class="no"><a href="https://scales.r-lib.org//reference/label_percent.html">percent</a></span>) +
<span class="fu">labs</span>(<span class="kw">title</span><span class="kw">=</span><span class="st">"Distribution of the number of children for women aged over 50 at time 100"</span>,<span class="kw">x</span><span class="kw">=</span><span class="st">"Number of children"</span>, <span class="kw">y</span><span class="kw">=</span><span class="st">""</span>)</pre></body></html></div>
<div class="sourceCode" id="cb52"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">pop_female_time</span>$<span class="no">children</span>) <span class="co">#Mean number of children </span></pre></body></html></div>
<pre><code>## [1] 1.836009</code></pre>
</div>
<div id="addition-of-cause-of-death-characteristics" class="section level1">
<h1 class="hasAnchor">
<a href="#addition-of-cause-of-death-characteristics" class="anchor"></a>Addition of “cause of death” characteristics</h1>
<p>In order to model different competing causes of death, several “death” events can be created, each modelling one cause of death.</p>
<div id="model-with-two-independent-causes-of-death" class="section level2">
<h2 class="hasAnchor">
<a href="#model-with-two-independent-causes-of-death" class="anchor"></a>Model with two independent causes of death</h2>
<p>We assume that individuals can from two main causes of death 1 and 2, supposed to be independent. Then, the death intensity at age <span class="math inline">\(a\)</span> is</p>
<p><span class="math display">\[ \mu(a) = \mu_1(a) + \mu_2(a),\]</span></p>
<p>with <span class="math inline">\(\mu_i(a)\)</span> the death intensity at age <span class="math inline">\(a\)</span> associated with cause <span class="math inline">\(i\)</span>.</p>
<p>This model can be simulated with two death events associated to cause 1 and 2, and adding a new characteristic recording the cause of death.</p>
<div class="sourceCode" id="cb54"><html><body><pre class="r"><span class="no">chi</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_characteristics.html">get_characteristics</a></span>(<span class="no">pop_sample_1e6</span>)
<span class="no">chi</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">chi</span>, <span class="st">'CoD'</span> <span class="kw">=</span> <span class="st">'int'</span>)</pre></body></html></div>
<div class="sourceCode" id="cb55"><html><body><pre class="r"><span class="no">params</span>$<span class="no">CoD1_prop</span> <span class="kw">&lt;-</span> <span class="fl">0.6</span></pre></body></html></div>
<div class="sourceCode" id="cb56"><html><body><pre class="r"><span class="no">death_event1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mk_event_individual.html">mk_event_individual</a></span>(<span class="kw">type</span> <span class="kw">=</span> <span class="st">"death"</span>, <span class="kw">name</span><span class="kw">=</span><span class="st">"CoD1"</span>,
                                    <span class="kw">intensity_code</span> <span class="kw">=</span> <span class="st">"if (I.male) result = CoD1_prop*death_male(age(I,t)); 
                                                      else result= CoD1_prop*death_female(age(I,t));"</span>,
                                    <span class="kw">kernel_code</span> <span class="kw">=</span> <span class="st">"I.CoD =1;"</span> <span class="co"># Records cause of death when event occurs.</span>
                                    )
<span class="no">death_event2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mk_event_individual.html">mk_event_individual</a></span>(<span class="kw">type</span> <span class="kw">=</span> <span class="st">"death"</span>, <span class="kw">name</span><span class="kw">=</span><span class="st">"CoD2"</span>,
                                    <span class="kw">intensity_code</span> <span class="kw">=</span> <span class="st">"if (I.male) result = (1-CoD1_prop)*death_male(age(I,t)); 
                                                      else result= (1-CoD1_prop)*death_female(age(I,t));"</span>,
                                    <span class="kw">kernel_code</span> <span class="kw">=</span> <span class="st">"I.CoD =2;"</span> <span class="co"># Records cause of death when event occurs.</span>
                                    )</pre></body></html></div>
<div class="sourceCode" id="cb57"><html><body><pre class="r"><span class="co"># Model creation</span>
<span class="no">model_CoD</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mk_model.html">mk_model</a></span>(
    <span class="kw">characteristics</span> <span class="kw">=</span> <span class="no">chi</span>,
    <span class="kw">events</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">birth_event</span>, <span class="no">death_event1</span>, <span class="no">death_event2</span>),
    <span class="kw">parameters</span> <span class="kw">=</span> <span class="no">params</span>)</pre></body></html></div>
<div class="sourceCode" id="cb58"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">model_CoD</span>)</pre></body></html></div>
<pre><code>## List of 6
##  $ individual_type :List of 3
##   ..$ names : chr [1:4] "birth" "death" "male" "CoD"
##   ..$ typesR: chr [1:4] "double" "double" "logical" "integer"
##   ..$ typesC: chr [1:4] "double" "double" "bool" "int"
##  $ parameters_types:List of 4
##   ..$ names  : chr [1:5] "p_male" "birth_rate" "death_male" "death_female" ...
##   ..$ typesR : chr [1:5] "double" "closure" "closure" "closure" ...
##   ..$ typesC : chr [1:5] "double" "function_x" "function_x" "function_x" ...
##   ..$ lengths: Named int [1:5] 1 1 1 1 1
##   .. ..- attr(*, "names")= chr [1:5] "p_male" "birth_rate" "death_male" "death_female" ...
##  $ events          :List of 3
##   ..$ :List of 5
##   .. ..$ name          : chr "birth"
##   .. ..$ type          : chr [1:2] "individual" "birth"
##   .. ..$ intensity_code: chr "if (I.male) result = 0; else result = birth_rate(age(I, t));"
##   .. ..$ kernel_code   : chr "newI.male = CUnif(0, 1) &lt; p_male;"
##   .. ..$ cpp_code      : chr "// Event \"birth\"\nstruct event_J_ : public event {\n    double __lambda(unsigned k, population const &amp; pop, d"| __truncated__
##   .. ..- attr(*, "class")= chr "event"
##   ..$ :List of 5
##   .. ..$ name          : chr "CoD1"
##   .. ..$ type          : chr [1:2] "individual" "death"
##   .. ..$ intensity_code: chr "if (I.male) result = CoD1_prop*death_male(age(I,t)); \n                                                      el"| __truncated__
##   .. ..$ kernel_code   : chr "I.CoD =1;"
##   .. ..$ cpp_code      : chr "// Event \"CoD1\"\nstruct event_J_ : public event {\n    double __lambda(unsigned k, population const &amp; pop, do"| __truncated__
##   .. ..- attr(*, "class")= chr "event"
##   ..$ :List of 5
##   .. ..$ name          : chr "CoD2"
##   .. ..$ type          : chr [1:2] "individual" "death"
##   .. ..$ intensity_code: chr "if (I.male) result = (1-CoD1_prop)*death_male(age(I,t)); \n                                                    "| __truncated__
##   .. ..$ kernel_code   : chr "I.CoD =2;"
##   .. ..$ cpp_code      : chr "// Event \"CoD2\"\nstruct event_J_ : public event {\n    double __lambda(unsigned k, population const &amp; pop, do"| __truncated__
##   .. ..- attr(*, "class")= chr "event"
##  $ cpp_code        : chr "// -*- coding: utf-8 -*-\n//[[Rcpp::depends(IBMPopSim)]]\n//[[Rcpp::depends(RcppArmadillo)]]\n//[[Rcpp::plugins"| __truncated__
##  $ sourceCpp       :List of 4
##   ..$ functions     : chr "popsim_cpp"
##   ..$ modules       : chr(0) 
##   ..$ cppSourcePath : chr "/private/var/folders/mb/3wx92xxx253492xvw_zv8x680000gn/T/RtmpNHv0Lc/sourceCpp-x86_64-apple-darwin19.4.0-1.0.4.6"| __truncated__
##   ..$ buildDirectory: chr "/private/var/folders/mb/3wx92xxx253492xvw_zv8x680000gn/T/RtmpNHv0Lc/sourceCpp-x86_64-apple-darwin19.4.0-1.0.4.6"| __truncated__
##  $ popsim_cpp      :function (pop_df, events_bounds, parameters, age_max, T0, T, clean_step, 
##     clean_ratio, seed, multithreading, num_threads = NA_integer_, verbose = FALSE)  
##  - attr(*, "class")= chr "model"</code></pre>
<div class="sourceCode" id="cb60"><html><body><pre class="r"><span class="no">init_pop_CoD</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">pop_sample_1e6</span>, <span class="st">"CoD"</span><span class="kw">=</span><span class="fl">NA</span>) <span class="co"># Initial population</span></pre></body></html></div>
<div class="sourceCode" id="cb61"><html><body><pre class="r"><span class="no">ev_bounds</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'birth'</span> <span class="kw">=</span> <span class="no">birth_max</span>, <span class="st">'CoD1'</span> <span class="kw">=</span> <span class="no">params</span>$<span class="no">CoD1_prop</span>*<span class="no">death_max</span>, <span class="st">'CoD2'</span> <span class="kw">=</span> (<span class="fl">1</span>-<span class="no">params</span>$<span class="no">CoD1_prop</span>)*<span class="no">death_max</span>)

<span class="no">sim_out_CoD</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/popsim.html">popsim</a></span>(<span class="no">model_CoD</span>,
       <span class="kw">population</span> <span class="kw">=</span> <span class="no">init_pop_CoD</span>,
       <span class="kw">events_bounds</span> <span class="kw">=</span> <span class="no">ev_bounds</span>,
       <span class="kw">parameters</span> <span class="kw">=</span> <span class="no">params</span>,
       <span class="kw">time</span> <span class="kw">=</span> <span class="fl">20</span>,
       <span class="kw">age_max</span> <span class="kw">=</span> <span class="fl">120</span>,
       <span class="kw">multithreading</span><span class="kw">=</span><span class="fl">TRUE</span>)</pre></body></html></div>
<pre><code>## [1] "birth" "CoD1"  "CoD2" 
## [1] "birth" "CoD1"  "CoD2" 
## [1] "birth" "CoD1"  "CoD2" 
## Simulation on  [0, 20]</code></pre>
</div>
<div id="death-and-exposure-table" class="section level2">
<h2 class="hasAnchor">
<a href="#death-and-exposure-table" class="anchor"></a>Death and exposure table</h2>
<p>The number of death for given age groups, time periods and for each cause of death can be computed with <code>death_table</code>.</p>
<div class="sourceCode" id="cb63"><html><body><pre class="r"><span class="co"># For each cause: number of death from males of age between [70,90] (single year of age groups) over the 5-year period [15,20]</span>
<span class="no">Dx_1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/death_table.html">death_table</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">sim_out_CoD</span>$<span class="no">population</span>, <span class="no">CoD</span><span class="kw">==</span><span class="fl">1</span> <span class="kw">&amp;</span> <span class="no">male</span><span class="kw">==</span><span class="no">T</span>),<span class="kw">ages</span> <span class="kw">=</span> <span class="fl">70</span>:<span class="fl">90</span>, <span class="kw">times</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">15</span>,<span class="fl">20</span>))
<span class="no">Dx_2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/death_table.html">death_table</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">sim_out_CoD</span>$<span class="no">population</span>, <span class="no">CoD</span><span class="kw">==</span><span class="fl">2</span> <span class="kw">&amp;</span> <span class="no">male</span><span class="kw">==</span><span class="no">T</span>),<span class="kw">ages</span> <span class="kw">=</span> <span class="fl">70</span>:<span class="fl">90</span>, <span class="kw">times</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">15</span>,<span class="fl">20</span>))</pre></body></html></div>
<div class="sourceCode" id="cb64"><html><body><pre class="r"><span class="no">Ex</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/exposure_table.html">exposure_table</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">sim_out_CoD</span>$<span class="no">population</span>, <span class="no">male</span><span class="kw">==</span><span class="no">T</span>),<span class="kw">ages</span> <span class="kw">=</span> <span class="fl">70</span>:<span class="fl">90</span>, <span class="kw">times</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">15</span>,<span class="fl">20</span>)) <span class="co"># Central exposure to risk</span>
<span class="no">mx_1</span> <span class="kw">&lt;-</span> <span class="no">Dx_1</span>/<span class="no">Ex</span> <span class="co"># Males central death rates by for Cause 1</span>
<span class="no">mx_2</span> <span class="kw">&lt;-</span> <span class="no">Dx_2</span>/<span class="no">Ex</span></pre></body></html></div>
<div class="sourceCode" id="cb65"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fl">70</span>:<span class="fl">89</span>,<span class="no">mx_1</span>, <span class="kw">col</span><span class="kw">=</span><span class="st">"red"</span>,<span class="kw">type</span><span class="kw">=</span><span class="st">"b"</span>,<span class="kw">main</span><span class="kw">=</span><span class="st">"Crude central death rate and true death intensity from cause 1"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="fl">70</span>:<span class="fl">89</span>,<span class="no">params</span>$<span class="no">CoD1_prop</span>*<span class="no">params</span>$<span class="fu">death_male</span>(<span class="fl">70</span>:<span class="fl">89</span>),<span class="kw">col</span> <span class="kw">=</span> <span class="st">"blue"</span>)</pre></body></html></div>
<p><img src="IBMPopSim-human_pop_files/figure-html/unnamed-chunk-46-1.png" width="700"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Daphné Giorgi, Sarah Kakaai, Vincent Lemaire.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>

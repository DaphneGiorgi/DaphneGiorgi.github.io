<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IBMPopSim package description • IBMPopSim</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="IBMPopSim package description">
<meta property="og:description" content="IBMPopSim">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">IBMPopSim</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/IBMPopSim.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/IBMPopSim_cpp.html">C++ essentials</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/IBMPopSim_human_pop.html">Human population</a>
    </li>
    <li>
      <a href="../articles/IBMPopSim_human_pop_IMD.html">Human population with swap</a>
    </li>
    <li>
      <a href="../articles/IBMPopSim_insurance_portfolio.html">Insurance portfolio</a>
    </li>
    <li>
      <a href="../articles/IBMPopSim_interaction.html">Population with genetically variable traits</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/DaphneGiorgi/IBMPopSim/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="IBMPopSim_files/header-attrs-2.2/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>IBMPopSim package description</h1>
                        <h4 class="author">Daphné Giorgi</h4>
                        <h4 class="author">Sarah Kaakaï</h4>
                        <h4 class="author">Vincent Lemaire</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/DaphneGiorgi/IBMPopSim/blob/master/vignettes/IBMPopSim.Rmd"><code>vignettes/IBMPopSim.Rmd</code></a></small>
      <div class="hidden name"><code>IBMPopSim.Rmd</code></div>

    </div>

    
    
<p>The IBMPopSim package is conceived to simulate the random evolution of structured population dynamics, called stochastic Individual Based Models (IBMs).</p>
<p>The package allows users to simulate the random evolution of a population in which individuals are characterized by their date of birth, a set of (discrete or continuous) attributes, and their potential date of death.<br>
The population is modified due to different types of events defined by the user, and occurring at random dates. These events include the birth/arrival or death/exit of an individual in the population, an individual changing characteristics.
Once the events modifying the population have been defined, the last step before simulating the population evolution is to specify the so-called events intensities, describing the frequency at which the different types of events occur in the population.</p>
<p style="color:red"> A reprendre Once the theory being explained, we proceed to the description of the package.   
Since the simulation of populations with a large size can be very time consuming, the main algorithm is compiled, using the Rcpp library.  
Hence, the user needs to write a very little C++ code to describe the events that can occur in the population.  
We give the detail of how this code has to be written here below.</p>
<p style="color:red"> plan de ce qui suit </p>
<div id="general-features-and-package-installation" class="section level1" number="1">
<h1 class="hasAnchor">
<a href="#general-features-and-package-installation" class="anchor"></a><span class="header-section-number">1</span> General features and package installation</h1>
<div id="brief-overview-of-individual-based-models-ibms" class="section level2" number="1.1">
<h2 class="hasAnchor">
<a href="#brief-overview-of-individual-based-models-ibms" class="anchor"></a><span class="header-section-number">1.1</span> Brief overview of Individual-Based-Models (IBMs)</h2>
<p>Stochastic Individual-Based-Models (IBMs) can be defined as a general class of population dynamics models, where different types of events can occur to individuals at random dates, depending on their characteristics and interactions with others.</p>
<p>The package IBMPopSim allows the efficient simulation of a wide class IBMs where individuals are marked by their age (or equivalently their date of birth) and a set of characteristics (gender, location, size, socioeconomic class…). <span style="color:red"> champs d’application</span></p>
<p>An IBM can always be summarized by the different types events that can occur to individuals and modify the population composition, and how frequently they happen. Let us start by recalling briefly these features before going into detailed on how they can be defined in IBMPopSim.</p>
<div id="eventsTh" class="section level3" number="1.1.1">
<h3 class="hasAnchor">
<a href="#eventsTh" class="anchor"></a><span class="header-section-number">1.1.1</span> Events type and associated kernel</h3>
<p>In IBMPopSim, the population can evolve according to six main types of events:</p>
<ul>
<li>
<strong>Birth event</strong>: addition of an individual of age 0 to the population.</li>
<li>
<strong>Death event</strong>: removal of an individual from the population.</li>
<li>
<strong>Entry event</strong>: arrival of an individual in the population.</li>
<li>
<strong>Exit (emmigration) event</strong>: exit from the population (other than death).</li>
<li>
<strong>Swap event</strong>: an individual changes of characteristics.</li>
<li>
<strong>custom events</strong>.</li>
</ul>
<p>With each event type is associated an <strong>event kernel</strong>, describing how the population is modified following the occurrence of the event. For instance, if an individual <code>I</code> dies or exit a time <span class="math inline">\(t\)</span>, the individual is removed from the population.</p>
<p>For other types of events, the event kernel has to be specified. Indeed, if an new individual enters the population (entry event), the rule for choosing the age and characteristics of this new individual has to be defined.<br>
For instance, the characteristics of a new individual in the population can be chosen uniformly in the space of all characteristics, or can depends on the distribution of his parents or those of the other individuals composing the population.</p>
</div>
<div id="Eventintensityth" class="section level3" number="1.1.2">
<h3 class="hasAnchor">
<a href="#Eventintensityth" class="anchor"></a><span class="header-section-number">1.1.2</span> Events intensity</h3>
<p>Once the different types or events and their action have been defined, it remains to define how frequently they can occur to define properly an IBM.</p>
<p>An event intensity is a function <span class="math inline">\(\lambda^e(I,t)\)</span> describing the frequency at which an event <span class="math inline">\(e\)</span> can occur to <em>an individual</em> <code>I</code> in the population at a time <span class="math inline">\(t\)</span>. Informally, given an history of the population <span class="math inline">\((\mathcal{F}_t)\)</span>,
<span class="math display">\[\begin{equation*}
  \mathbb{P}(\text{event } e \text{ occurring to I during } (t,t+dt] | \mathcal{F}_t) = \lambda^e(I,t).
\end{equation*}\]</span></p>
<p>The intensity function <span class="math inline">\(\lambda^e\)</span> can depend on:</p>
<ul>
<li>The individual’s age and characteristics,</li>
<li>The time <span class="math inline">\(t\)</span>,</li>
<li>Interactions with other individuals,</li>
<li>Other model parameters.</li>
</ul>
<p>When the intensity <span class="math inline">\(\lambda^e\)</span> does not depends on the other individuals living in the population (there are no interactions for this specific event), the intensity function is said to be in the class of <strong>individual</strong> intensity functions. This is case for instance when the death intensity of individuals only depend on their age and characteristics.<br>
Otherwise, the intensity function is said to be the class of <strong>interaction</strong> functions. In this package, we mainly focus on ``quadratic interactions", that is of intensity functions of the form</p>
<p><span class="math display" id="eq:interaction">\[\begin{equation}
\lambda^e(I,t) = \sum_{J \in pop} U(I,J,t),
  \tag{1.1}
\end{equation}\]</span></p>
<p>where the interaction function <span class="math inline">\(U(I,J,t)\)</span> represent the interaction between two individuals <span class="math inline">\(I\)</span> and <span class="math inline">\(J\)</span> at time <span class="math inline">\(t\)</span>. See for instance the vignette <span style="color:red">…</span> for examples of intensities with interactions.</p>
<p>Sometimes, the intensity refers to the frequency at which an event can occur in <em>all the population</em>. This is the case for instance when individuals enter the population at a constant rate <span class="math inline">\(C^e\)</span> (intensity of class <code>poisson</code>), or at a rate only depending on time <span class="math inline">\((\Lambda^e_t)\)</span> (intensity of class <code>inhomogeneous_poisson</code>). In this case, the intensity <span class="math inline">\(\Lambda^e_t\)</span> is informally defined as</p>
<p><span class="math display">\[\begin{equation}
\mathbb{P}(\text{event } e \text{ occurring in the population during } (t,t+dt] | \mathcal{F}_t) = \Lambda^e_t.
\end{equation}\]</span></p>
</div>
</div>
<div id="overview-of-package-structure" class="section level2" number="1.2">
<h2 class="hasAnchor">
<a href="#overview-of-package-structure" class="anchor"></a><span class="header-section-number">1.2</span> Overview of package structure</h2>
<p>Emphasis was placed on code efficiency (speed of execution) and ease of implementation while trying to be as general as possible.</p>
<p>We have chosen to let the user write a few lines of C++ code to make the link between the characteristics of the individual, the population <code>pop</code>, the time <code>t</code> and the parameters of the model. These parameters are important because they allow to modify the model without recompiling the code. The C++ code to be written must be simple and does not require a great knowledge of C++: it is enough to respect the rules of syntax, to do arithmetic operations and tests.</p>
<p>The user’s C++ code is concatenated with internal code in the package. Compilation is done via the <code>sourceCpp</code> call of the <code>Rcpp</code> package. The code produced is usually very fast and can be multithreaded.</p>
</div>
<div id="installation" class="section level2" number="1.3">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a><span class="header-section-number">1.3</span> Installation</h2>
<p>The latest stable version can be installed from CRAN:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">'IBMPopSim'</span>)</pre></body></html></div>
<p>The latest development version can be installed from github:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># install.packages("devtools")</span>
<span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span>(<span class="st">'giorgi/IBMPopSim'</span>)</pre></body></html></div>
<div id="first-example-to-check-installation" class="section level3" number="1.3.1">
<h3 class="hasAnchor">
<a href="#first-example-to-check-installation" class="anchor"></a><span class="header-section-number">1.3.1</span> First example to check installation</h3>
<p>To illustrate the use of the package and to check the installation, a simple birth and death model is implemented.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">IBMPopSim</span>)

<span class="no">init_size</span> <span class="kw">&lt;-</span> <span class="fl">100000</span>
<span class="no">pop</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">birth</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="no">init_size</span>), <span class="kw">death</span> <span class="kw">=</span> <span class="fl">NA</span>)

<span class="no">birth</span> <span class="kw">=</span> <span class="fu"><a href="../reference/mk_event_poisson.html">mk_event_poisson</a></span>(<span class="kw">type</span> <span class="kw">=</span> <span class="st">'birth'</span>, <span class="kw">intensity</span> <span class="kw">=</span> <span class="st">'lambda'</span>)
<span class="no">death</span> <span class="kw">=</span> <span class="fu"><a href="../reference/mk_event_poisson.html">mk_event_poisson</a></span>(<span class="kw">type</span> <span class="kw">=</span> <span class="st">'death'</span>, <span class="kw">intensity</span> <span class="kw">=</span> <span class="st">'mu'</span>)
<span class="no">params</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">'lambda'</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="st">'mu'</span> <span class="kw">=</span> <span class="fl">100</span>)

<span class="co"># mk_model compiles C++ code using sourceCpp from Rcpp</span>
<span class="no">birth_death</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mk_model.html">mk_model</a></span>(<span class="kw">events</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">birth</span>, <span class="no">death</span>),
                        <span class="kw">parameters</span> <span class="kw">=</span> <span class="no">params</span>)</pre></body></html></div>
<p>If there are no errors then the C++ build environment is compatible with the package. The model is created and a C++ code has been compiled. The simulation is done using the <code>popsim</code> function.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">sim_out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/popsim.html">popsim</a></span>(<span class="kw">model</span> <span class="kw">=</span> <span class="no">birth_death</span>,
                  <span class="kw">population</span> <span class="kw">=</span> <span class="no">pop</span>,
                  <span class="kw">events_bounds</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'birth'</span> <span class="kw">=</span> <span class="no">params</span>$<span class="no">lambda</span>, <span class="st">'death'</span> <span class="kw">=</span> <span class="no">params</span>$<span class="no">mu</span>),
                  <span class="kw">parameters</span> <span class="kw">=</span> <span class="no">params</span>,
                  <span class="kw">time</span> <span class="kw">=</span> <span class="fl">10</span>)
<span class="co">## Simulation on  [0, 10]</span>

<span class="no">num_births</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">sim_out</span>$<span class="no">population</span>$<span class="no">birth</span>) - <span class="no">init_size</span>
<span class="no">num_deaths</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">sim_out</span>$<span class="no">population</span>$<span class="no">death</span>))
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"births"</span> <span class="kw">=</span> <span class="no">num_births</span>, <span class="st">"deaths"</span> <span class="kw">=</span> <span class="no">num_deaths</span>))
<span class="co">## births deaths </span>
<span class="co">##    981    972</span></pre></body></html></div>
</div>
</div>
<div id="quick-model-creation-and-simulation" class="section level2" number="1.4">
<h2 class="hasAnchor">
<a href="#quick-model-creation-and-simulation" class="anchor"></a><span class="header-section-number">1.4</span> Quick model creation and simulation</h2>
<p>Before going into details on the different steps for defining an IBM in IBMPopSim, let us first go quickly through an example of model creation and simulation.<br>
In order to define a model, the user must specify three building blocks:</p>
<ul>
<li>An initial population (see Section <a href="#population">2.1</a>),</li>
<li>The model parameters (see Section <a href="#params">2.2</a>),</li>
<li>The different events (see Section <a href="#events">2.3</a>).</li>
</ul>
<p>The model can then be created from these three blocks.</p>
<ul>
<li>We take here an initial population, stored in a data frame, composed of <span class="math inline">\(100\,000\)</span> individuals marked by their gender (encoded by a Boolean characteristic):</li>
</ul>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">pop</span> <span class="kw">&lt;-</span> <span class="no">EW_pop_14</span>$<span class="no">sample</span></pre></body></html></div>
<ul>
<li>The second step is to define the model parameters’ list:</li>
</ul>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">params</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"alpha"</span> <span class="kw">=</span>  <span class="fl">0.008</span>, <span class="st">"beta"</span> <span class="kw">=</span><span class="fl">0.02</span>, <span class="st">"p_male"</span><span class="kw">=</span> <span class="fl">0.51</span>,
               <span class="st">"birth_rate"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/stepfun.html">stepfun</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">15</span>,<span class="fl">40</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">0.05</span>,<span class="fl">0</span>)))</pre></body></html></div>
<ul>
<li>The last step is to defined the events that can occur in the population, here birth and death events:</li>
</ul>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">death_event</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mk_event_individual.html">mk_event_individual</a></span>(<span class="kw">type</span> <span class="kw">=</span> <span class="st">"death"</span>,
                  <span class="kw">intensity_code</span> <span class="kw">=</span> <span class="st">"result = alpha * exp(beta * age(I, t));"</span>)

<span class="no">birth_event</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mk_event_individual.html">mk_event_individual</a></span>(<span class="kw">type</span> <span class="kw">=</span> <span class="st">"birth"</span>,
                  <span class="kw">intensity_code</span> <span class="kw">=</span> <span class="st">"result = birth_rate(age(I,t));"</span>,
                  <span class="kw">kernel_code</span> <span class="kw">=</span> <span class="st">"newI.male = CUnif(0, 1) &lt; p_male;"</span>)</pre></body></html></div>
<p>Note that these events contain some C++ statements that depend (implicitly) on the previously declared parameters in variable <code>params</code>.</p>
<ul>
<li>Finally, the model is created by calling the function <code>mk_model</code>. A C++ source code is obtained from the events and parameters, then compiled using the <code>sourceCpp</code> function of the <code>Rcpp</code> package.</li>
</ul>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">model</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mk_model.html">mk_model</a></span>(<span class="kw">characteristics</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_characteristics.html">get_characteristics</a></span>(<span class="no">pop</span>),
                  <span class="kw">events</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">death_event</span>, <span class="no">birth_event</span>),
                  <span class="kw">parameters</span> <span class="kw">=</span> <span class="no">params</span>)</pre></body></html></div>
<ul>
<li>In order to simulate a random trajectory of the population until a given time <code>T</code> bounds on the events intensities have to be specified:</li>
</ul>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">a_max</span> <span class="kw">&lt;-</span> <span class="fl">115</span>
<span class="no">events_bounds</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"death"</span> <span class="kw">=</span> <span class="no">params</span>$<span class="no">alpha</span> * <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="no">params</span>$<span class="no">beta</span> * <span class="no">a_max</span>),
                  <span class="st">"birth"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">params</span>$<span class="no">birth_rate</span>))</pre></body></html></div>
<p>Then, the function <code>popsim</code> can be called:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">sim_out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/popsim.html">popsim</a></span>(<span class="no">model</span>, <span class="no">pop</span>, <span class="no">events_bounds</span>, <span class="no">params</span>,
                  <span class="kw">age_max</span> <span class="kw">=</span> <span class="no">a_max</span>, <span class="kw">time</span> <span class="kw">=</span> <span class="fl">30</span>)
<span class="co">## Simulation on  [0, 30]</span></pre></body></html></div>
<ul>
<li>The data frame <code>sim_out$population</code> contains the information (date of birth, date of death, gender) on individuals who lived in the population over the period <span class="math inline">\([0,30]\)</span>. Functions of the package allows to provide aggregated information on the population.</li>
</ul>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">pop_out</span> <span class="kw">&lt;-</span> <span class="no">sim_out</span>$<span class="no">population</span>
<span class="no">female_pop</span> <span class="kw">&lt;-</span> <span class="no">pop_out</span>[<span class="no">pop_out</span>$<span class="no">male</span><span class="kw">==</span><span class="fl">FALSE</span>, ]
<span class="fu"><a href="../reference/age_pyramid.html">age_pyramid</a></span>(<span class="no">female_pop</span>, <span class="kw">ages</span> <span class="kw">=</span> <span class="fl">85</span>:<span class="fl">90</span>, <span class="kw">time</span> <span class="kw">=</span> <span class="fl">30</span>)
<span class="co">##       age  male value</span>
<span class="co">## 1 85 - 86 FALSE   231</span>
<span class="co">## 2 86 - 87 FALSE   256</span>
<span class="co">## 3 87 - 88 FALSE   230</span>
<span class="co">## 4 88 - 89 FALSE   181</span>
<span class="co">## 5 89 - 90 FALSE   192</span>
<span class="no">Dxt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/death_table.html">death_table</a></span>(<span class="no">female_pop</span>, <span class="kw">ages</span> <span class="kw">=</span> <span class="fl">85</span>:<span class="fl">90</span>, <span class="kw">times</span> <span class="kw">=</span> <span class="fl">20</span>:<span class="fl">30</span>)
<span class="no">Ext</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/exposure_table.html">exposure_table</a></span>(<span class="no">female_pop</span>, <span class="kw">ages</span> <span class="kw">=</span> <span class="fl">85</span>:<span class="fl">90</span>, <span class="kw">times</span> <span class="kw">=</span> <span class="fl">20</span>:<span class="fl">30</span>)</pre></body></html></div>
<ul>
<li>Note that parameters of the model can be changed without recompiling the model.</li>
</ul>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">params</span>$<span class="no">beta</span> <span class="kw">&lt;-</span> <span class="fl">0.01</span>

<span class="co"># Update death event bound:</span>
<span class="no">events_bounds</span>[<span class="st">"death"</span>] <span class="kw">&lt;-</span> <span class="no">params</span>$<span class="no">alpha</span> * <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="no">params</span>$<span class="no">beta</span> * <span class="no">a_max</span>)

<span class="no">sim_out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/popsim.html">popsim</a></span>(<span class="no">model</span>, <span class="no">pop</span>, <span class="no">events_bounds</span>, <span class="no">params</span>,
                  <span class="kw">age_max</span> <span class="kw">=</span> <span class="no">a_max</span>, <span class="kw">time</span> <span class="kw">=</span> <span class="fl">30</span>)</pre></body></html></div>
</div>
</div>
<div id="package-description" class="section level1" number="2">
<h1 class="hasAnchor">
<a href="#package-description" class="anchor"></a><span class="header-section-number">2</span> Package description</h1>
<p>The first step to define a model in IBMPopSim is to define the population structure.</p>
<div id="population" class="section level2" number="2.1">
<h2 class="hasAnchor">
<a href="#population" class="anchor"></a><span class="header-section-number">2.1</span> Population</h2>
<div id="initial-population" class="section level3" number="2.1.1">
<h3 class="hasAnchor">
<a href="#initial-population" class="anchor"></a><span class="header-section-number">2.1.1</span> Initial population</h3>
<p>A population is a dataframe in which each row corresponds to an individual, and
which has at least two columns:</p>
<ul>
<li>A column <code>birth</code> containing the birth dates of individuals in the population.</li>
<li>A column <code>death</code> containing the birth dates of individuals in the population ( <code>NA</code> for alive individuals).</li>
</ul>
<p>The dataframe can contain more than two columns if individuals are described by additional characteristics such as gender, size, spatial location…</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">pop</span>)
<span class="co">##       birth death  male</span>
<span class="co">## 1 -106.9055    NA FALSE</span>
<span class="co">## 2 -106.8303    NA FALSE</span>
<span class="co">## 3 -104.5097    NA  TRUE</span>
<span class="co">## 4 -104.2218    NA FALSE</span>
<span class="co">## 5 -103.5225    NA FALSE</span>
<span class="co">## 6 -103.3644    NA FALSE</span></pre></body></html></div>
<p>In the example above, individuals are described by their birth and death dates, as well a Boolean characteristics called <code>male</code>. For instance, the first individual is a female whose age at <span class="math inline">\(t_0=0\)</span> is <span class="math inline">\(t_0 - (-106.9055) = 106.9055\)</span>.</p>
<p>We draw the attention to the fact that some characteristics names are forbidden, or are reserved to specific cases. The reserved words include:</p>
<ul>
<li>
<code>male</code>: can only be used for a Boolean characteristics, usually referring to the individuals’ sex/gender.</li>
<li>
<code>id</code>: can only be used in order to defined the individuals unique identifier (see Section <a href="#simulationswap">2.6</a>).</li>
<li>
<code>time</code> : forbidden as characteristics or variable name.<br>
</li>
<li>C++ reserved words: forbidden as characteristics or variable name. Note that <code>char</code>
is a reserved word. See <a href="https://en.cppreference.com/w/cpp/keyword">here</a> for a comprehensive list of C++ reserved words.</li>
</ul>
<p>Attention: I, J, pop, newI, t, k</p>
</div>
<div id="individuals" class="section level3" number="2.1.2">
<h3 class="hasAnchor">
<a href="#individuals" class="anchor"></a><span class="header-section-number">2.1.2</span> Individuals</h3>
<p>During the model creation, a population of individuals is created from the initial population dataframe. The C++ class <code>individual</code> contains several useful functions, whose context of use is detailed in the following. For instance,</p>
<ul>
<li>
<code>age(I,t)</code> or <code>I.age(t)</code> returns the age of an individual <code>I</code> at time <code>t</code>.</li>
<li>
<code>newI.set_age(a,t)</code> sets the birth date <span class="math inline">\(t-a\)</span> of a new individual called <code>newI</code>, of age <code>a</code> at time <code>t</code>.</li>
</ul>
<p>If <code>Chi</code> is the name of a characteristic, then <code>I.Chi</code> returns the value of the characteristic <code>Chi</code> for the individual <code>I</code>. For instance, in the previous example <code>I.male</code> would equal to <code>TRUE</code> if <code>I</code> is a male of <code>FALSE</code> if <code>I</code> is a female.</p>
</div>
</div>
<div id="params" class="section level2" number="2.2">
<h2 class="hasAnchor">
<a href="#params" class="anchor"></a><span class="header-section-number">2.2</span> Model parameters</h2>
<p>A list of model parameters can be defined to simplify the events creation. These parameters can be of various types, summarized in the following table:</p>
<table class="table">
<caption>
<span id="tab:unnamed-chunk-4">Table 2.1: </span>Parameters</caption>
<thead><tr class="header">
<th align="left">Types of parameters</th>
<th align="left">Parameters</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">
<code>R</code> objects</td>
<td align="left">Numeric, logical, character</td>
</tr>
<tr class="even">
<td align="left">
<code>Armadillo</code> objects</td>
<td align="left">Vector (<code>arma::vec</code>), matrix (numeric) (<code>arma::mat</code>)</td>
</tr>
<tr class="odd">
<td align="left">List of IBMPopSim functions</td>
<td align="left">
<code>stepfun</code>, <code>linfun</code>, piecewise_x<code>,</code>piecewise_xy<code>,</code>gompertz<code>,</code>weibull`</td>
</tr>
</tbody>
</table>
<p>For example,</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">params</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"coeff"</span> <span class="kw">=</span> <span class="fl">1.1</span>,
               <span class="st">"death_function"</span> <span class="kw">=</span> <span class="fu"><a href="../reference/gompertz.html">gompertz</a></span>(<span class="fl">0.1</span>,<span class="fl">0.005</span>))</pre></body></html></div>
<p>creates a numeric parameter <code>coeff</code> and a Gompertz function <code>death_function</code> which can be used when creating the events of the model.</p>
<p><strong>IBMPopSim functions</strong> are classes of functions predefined in the package to simplify models creation. For instance, <code><a href="../reference/gompertz.html">gompertz(a,b)</a></code> returns the function <span class="math inline">\(g(x) = a \exp(bx)\)</span>
and <code>stepfun</code> is the usual R function for the creation of step functions. Another example is <code>piecewise_xy</code> which allow the creation of age and time functions. See Section <a href="#IBMfunctions"><strong>??</strong></a> for a description of all IBM functions, and Section <a href="#armadillo"><strong>??</strong></a> for more details of Armadillo objects.</p>
</div>
<div id="events" class="section level2" number="2.3">
<h2 class="hasAnchor">
<a href="#events" class="anchor"></a><span class="header-section-number">2.3</span> Events creations</h2>
<p>The last and most important step of the model creation is the events creation. The call to the function creating an event is of form,</p>
<p><code>mk_event_CLASS(type = "TYPE", name ="NAME", kernel_code = "KERNEL_CODE", ...)</code></p>
<p>where <code>CLASS</code> is replaced by the class of the event intensity, <code>type</code> is the event type and <code>kernel_code</code> the event kernel.</p>
<p>The other arguments depend on the intensity class. Tables <a href="#tab:evtype">2.2</a> and <a href="#tab:evclass">2.3</a> summarize the different intensity classes and types of events introduced in Section <a href="#eventsTh">1.1.1</a>.</p>
<table class="table">
<caption>
<span id="tab:evtype">Table 2.2: </span>Event types</caption>
<thead><tr class="header">
<th align="left">Event type</th>
<th align="left"><code>Type</code></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Birth</td>
<td align="left"><code>birth</code></td>
</tr>
<tr class="even">
<td align="left">Entry</td>
<td align="left"><code>entry</code></td>
</tr>
<tr class="odd">
<td align="left">Death</td>
<td align="left"><code>death</code></td>
</tr>
<tr class="even">
<td align="left">Exit</td>
<td align="left"><code>exit</code></td>
</tr>
<tr class="odd">
<td align="left">Swap</td>
<td align="left"><code>swap</code></td>
</tr>
<tr class="even">
<td align="left">Custom</td>
<td align="left"><code>custom</code></td>
</tr>
</tbody>
</table>
<table class="table">
<caption>
<span id="tab:evclass">Table 2.3: </span>Intensity classes</caption>
<thead><tr class="header">
<th align="left">Intensity class</th>
<th align="left"><code>Class</code></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Poisson</td>
<td align="left"><code>poisson</code></td>
</tr>
<tr class="even">
<td align="left">Inhomogeneous Poisson</td>
<td align="left"><code>inhomogeneous_poisson</code></td>
</tr>
<tr class="odd">
<td align="left">Individual</td>
<td align="left"><code>individual</code></td>
</tr>
<tr class="even">
<td align="left">Interaction</td>
<td align="left"><code>interaction</code></td>
</tr>
</tbody>
</table>
<p>The intensity function and kernel of an event are defined through arguments of the function <code>mk_event_CLASS</code>. These arguments are strings composed of few lines of code defining an event frequency and its action of the event on individuals. Since the model is compiled using Rcpp, the code should be written in C++. However, thanks to the model parameters and functions/variables of the package, even the non-experienced C++ user can define a model quite easily. Several examples are given in the several vignettes of this package, and basic C++ tools are presented in Section <a href="#essentials">3</a>.</p>
<p>The optional argument <code>name</code> gives a name to the event. If not specified, the name of the event is its type, for instance <code>death</code>. However, a name must be specified if the model is composed of several events with the same name.</p>
<div id="event-type-and-kernel-code" class="section level3" number="2.3.1">
<h3 class="hasAnchor">
<a href="#event-type-and-kernel-code" class="anchor"></a><span class="header-section-number">2.3.1</span> Event type and kernel code</h3>
<p>The argument <code>kernel_code</code> is <code>NULL</code> by default and doesn’t have to be specified for death and exit events. For those types of events, the event kernel is automatically generated during the model creation. For instance, if the user defines a <strong>death event</strong>, the C++ code generated is</p>
<p><code>pop.kill(k, t);</code></p>
<p>which removes the individual number <code>k</code> from the population <code>pop</code> if he dies. No kernel has to be specified by the user.</p>
<p>If an <strong>exit events</strong> is defined, a characteristic <code>out</code> is automatically added to individuals in the population. When an individual <code>I</code> exit the population,<code>I.out</code> is set <code>TRUE</code> and his exit time is recorded as a “death” date.</p>
<p>For a <strong>birth event</strong>, the default generated event kernel is that an individual <code>I</code> gives birth to a new individual <code>newI</code> of age 0 at the current time <code>t</code>, which has the same characteristics than his parent <code>I</code>. If no kernel is specified, the default generated C++ code for a birth event is:</p>
<pre><code>individual newI = I; 
newI.birth_date = t;  
pop.add(newI); </code></pre>
<p>The user can modify the birth kernel, by specify the argument `<code>kernel_code</code> of <code>mk_event_CLASS</code>. In this case, the generated code is</p>
<pre><code>individual newI = I;   
newI.birth_date = t;  
_KERNEL_CODE_
pop.add(newI);</code></pre>
<p>where <code>_KERNEL_CODE_</code> is replaced by the content of the <code>kernel_code</code> argument. For instance, in a population where individuals are characterized by their gender, the kernel code</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">birth_kernel_code</span> <span class="kw">&lt;-</span> <span class="st">"newI.male = (CUnif(0, 1) &lt; p_male);"</span></pre></body></html></div>
<p>creates new individuals which are males with probability <code>p_male</code>, or females otherwise. Here, <code>p_male</code> should be included in the parameters of the model.</p>
<p>When an <strong>entry events</strong> occurs the individual entering the population is not of age <span class="math inline">\(0\)</span>. In this case, the user must specify the <code>kernel_code</code> argument indicating how the age and characteristics of the new individual are chosen. For instance, with</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">entry_kernel_code</span> <span class="kw">&lt;-</span> <span class="st">"double a = CUnif(20,40); 
                      newI.set_age(a,t); 
                      newI.male = (CUnif(0, 1) &lt; p_male);
                      newI.immigrant =TRUE;"</span></pre></body></html></div>
<p>individuals who enter the population have age <code>a</code> taken uniformly in <span class="math inline">\([20,40]\)</span>. In this example, the characteristic <code>immigrant</code> has been added to the population to distinguish individuals who entered the population from individuals “born in the population”.</p>
<p>The available variables for the birth and entry events C++ kernel codes are:</p>
<table class="table">
<caption>
<span id="tab:varBirth">Table 2.4: </span>C++ variables available for birth and entry events kernel code</caption>
<thead><tr class="header">
<th align="left">Variable</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>I</code></td>
<td align="left">Current individual</td>
</tr>
<tr class="even">
<td align="left"><code>t</code></td>
<td align="left">Current time</td>
</tr>
<tr class="odd">
<td align="left"><code>pop</code></td>
<td align="left">Current population (vector)</td>
</tr>
<tr class="even">
<td align="left"><code>newI</code></td>
<td align="left">New individual. By default <code>newI = I</code> with <code>newI.birth = t</code>
</td>
</tr>
<tr class="odd">
<td align="left">Model parameters</td>
<td align="left">Depends on the model</td>
</tr>
</tbody>
</table>
<p>Finally, the C++ kernel code for a <strong>swap event</strong> is only specified by the <code>kernel_code</code> argument of <code>mk_event_CLASS</code> which must specify how the new characteristics of the individual are chosen. The kernel code can depend on the following variables:</p>
<table class="table">
<caption>
<span id="tab:varSwap">Table 2.5: </span>C++ variables available for swap events kernel code</caption>
<thead><tr class="header">
<th align="left">Variable</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>I</code></td>
<td align="left">Current individual</td>
</tr>
<tr class="even">
<td align="left"><code>t</code></td>
<td align="left">Current time</td>
</tr>
<tr class="odd">
<td align="left"><code>pop</code></td>
<td align="left">Current population (vector)</td>
</tr>
<tr class="even">
<td align="left">Model parameters</td>
<td align="left">Depends on the model</td>
</tr>
</tbody>
</table>
<p>We can now describe the different intensity classes.</p>
</div>
<div id="event-creation-with-individual-intensity" class="section level3" number="2.3.2">
<h3 class="hasAnchor">
<a href="#event-creation-with-individual-intensity" class="anchor"></a><span class="header-section-number">2.3.2</span> Event creation with individual intensity</h3>
<p>As explained in <a href="#Eventintensityth">1.1.2</a>, events with intensities in the class <code>individual</code> are intensity functions which depend only the individual age and characteristics and on time.<br>
They are created using the function</p>
<pre><code>mk_event_individual(type = "TYPE", name ="name" 
                    intensity_code = "INTENSITY",   
                    kernel_code = "KERNEL_CODE"),</code></pre>
<p>The <code>intensity_code</code> argument contains few lines C++ code describing the intensity function. The available variables for the intensity code are given in Table <a href="#tab:varInd">2.6</a> :</p>
<table class="table">
<caption>
<span id="tab:varInd">Table 2.6: </span>C++ variables available for individual intensities</caption>
<thead><tr class="header">
<th align="left">Variable</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>I</code></td>
<td align="left">Current individual</td>
</tr>
<tr class="even">
<td align="left"><code>t</code></td>
<td align="left">Current time</td>
</tr>
<tr class="odd">
<td align="left">Model parameters</td>
<td align="left">Depends on the model</td>
</tr>
</tbody>
</table>
<p>The intensity value has to be stored in a variable called <code>result</code>. For instance, the intensity code</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">death_intensity</span><span class="kw">&lt;-</span> <span class="st">" if (I.male)
                      result = alpha_1*exp(beta_1*age(I, t));
                    else
                      result = alpha_2*exp(beta_2*age(I,t));"</span></pre></body></html></div>
<p>corresponds to a death intensity equal to <span class="math inline">\(d_1(a) = \alpha_1 \exp(\beta_1 a)\)</span> for males and <span class="math inline">\(d_2(a) = \alpha_2 \exp(\beta_2 a)\)</span> for females. In this case, the intensity function depends on the individuals’ age, gender, and on the model parameters <span class="math inline">\(\alpha = (\alpha_1, \alpha_2)\)</span> and <span class="math inline">\(\beta = (\beta_1, \beta_2)\)</span>.</p>
<p>The code</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="no">time_dep_function</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/piecewise_xy.html">piecewise_xy</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">5</span>),
                                  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="../reference/gompertz.html">gompertz</a></span>(<span class="fl">0.1</span>,<span class="fl">0.005</span>),
                                       <span class="fu"><a href="../reference/gompertz.html">gompertz</a></span>(<span class="fl">0.08</span>,<span class="fl">0.005</span>)))
<span class="fu">time_dep_function</span>(<span class="fl">0</span>,<span class="fl">65</span>) <span class="co"># death intensity at time 0 and age 65.</span>
<span class="co">## [1] 0.1384031</span>
<span class="no">params</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"death_function"</span><span class="kw">=</span> <span class="no">time_dep_function</span>)

<span class="no">time_dep_intensity</span><span class="kw">&lt;-</span> <span class="st">"result=death_function(t,age(I,t));"</span></pre></body></html></div>
<p>creates a death intensity depending on a age and time, equal to</p>
<p><span class="math display">\[\begin{equation*}
d(t,a) = 0.1\exp(0.005a) 1_{\{0\leq t &lt;5\}} + 0.08\exp(0.005a) 1_{\{5\leq t\}} 
\end{equation*}\]</span></p>
</div>
<div id="event-creation-with-interaction-intensity" class="section level3" number="2.3.3">
<h3 class="hasAnchor">
<a href="#event-creation-with-interaction-intensity" class="anchor"></a><span class="header-section-number">2.3.3</span> Event creation with interaction intensity</h3>
<p>Events with intensities in the class <code>interaction</code> are events which occur to an individual at a frequency which is the result of interactions with other members of the population (see <a href="#Eventintensityth">1.1.2</a>), and which can be written as</p>
<p><span class="math display" id="eq:interaction">\[\begin{equation*}
\lambda^e(I,t) = \sum_{J \in pop} U(I,J,t),
  \tag{1.1}
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(U(I,J,t)\)</span> is the intensity of the interaction between individual <span class="math inline">\(I\)</span> and <span class="math inline">\(J\)</span>.</p>
<p>An event with intensity in the class <code>interaction</code> is created by calling the function</p>
<pre><code>mk_event_interaction(type = "TYPE",  
    interaction_code = "INTERACTION_CODE",  
    interaction_type="random",
    kernel_code = "KERNEL_CODE").</code></pre>
<p>The <code>intensity_code</code> argument contains few lines of C++ code describing
the interaction function <span class="math inline">\(U\)</span>. The available variables for the intensity code are:</p>
<table class="table">
<caption>
<span id="tab:varInt">Table 2.7: </span>C++ variables available for interaction code</caption>
<thead><tr class="header">
<th align="left">Variable</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>I</code></td>
<td align="left">Current individual</td>
</tr>
<tr class="even">
<td align="left"><code>J</code></td>
<td align="left">Another individual in the population</td>
</tr>
<tr class="odd">
<td align="left"><code>t</code></td>
<td align="left">Current time</td>
</tr>
<tr class="even">
<td align="left">Model parameters</td>
<td align="left">Depends on the model</td>
</tr>
</tbody>
</table>
<p>Here is example of interaction code:</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="no">death_interaction_code</span><span class="kw">&lt;-</span> <span class="st">" result = max(J.size -I.size,0);"</span></pre></body></html></div>
<p>In the example above, the death intensity of an individual <code>I</code> is the result of competition between individuals, depending on a characteristic named <code>size</code>. If <code>I</code> meets randomly an individual <code>J</code> of size bigger than <code>I.size</code>, he can die at the intensity <code>J.size-I.size</code>. The bigger is <code>I.size</code>, the lower is the death intensity of individual <code>I</code>.</p>
<p>The argument <code>interaction_type</code>, set by default at <code>random</code>, is an algorithm choice for simulating the model.<br>
When <code>interaction_type=full</code>, the intensity of an individual is computed making the sum over all the individuals in the population of the interactions with the given individual. In IBMPopSim, we introduced a “randomized” algorithm, in which the intensity of an individual is computed by picking randomly another individual in the population and computing its interaction function with the given individual. In most cases, the <code>random</code> algorithm is much faster than the <code>full</code> algorithm.</p>
<p>Note that events with individual intensities are also much faster to simulate since they only require to observe <em>one</em> individual to be computed.</p>
</div>
<div id="poisson-and-inhomogeneous-poisson-events-creation" class="section level3" number="2.3.4">
<h3 class="hasAnchor">
<a href="#poisson-and-inhomogeneous-poisson-events-creation" class="anchor"></a><span class="header-section-number">2.3.4</span> Poisson and Inhomogeneous Poisson events creation</h3>
<p>When a event occur in the population with an intensity which does not depend on the population, the event intensity is of (inhomogeneous) Poisson class. When the event intensity is simply a constant, the class is called Poisson in reference to Poisson processes intensities. Such events are created with the function</p>
<pre><code><a href="../reference/mk_event_poisson.html">mk_event_poisson(type="TYPE",   
                 intensity="CONSTANT",   
                 kernel_code = "KERNEL_CODE")</a></code></pre>
<p>If the parameters <code>lambda</code> has been defined in the list of model parameters, then</p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="fu"><a href="../reference/mk_event_poisson.html">mk_event_poisson</a></span>(<span class="kw">type</span> <span class="kw">=</span> <span class="st">"entry"</span>, <span class="kw">intensity</span> <span class="kw">=</span> <span class="st">"lambda"</span>,
                 <span class="kw">kernel_code</span> <span class="kw">=</span><span class="st">"double a_I= CNorm(20,2); 
                               newI.set_age(a_I,t);"</span>)</pre></body></html></div>
<p>creates an event of type Entry, where individuals enter the population at a constant intensity <code>lambda</code>. When an individual <code>newI</code> enters the population at time <code>t</code>, his age is chosen as a normally distributed random variable, with mean 20 and variance 4, using the function <code>CNorm()</code> (<span style="color:red"> see doc </span>).
When the intensity depends on time (but not on the population), the event can be created similarly by using the function</p>
<pre><code><a href="../reference/mk_event_inhomogeneous_poisson.html">mk_event_inhomogeneous_poisson(type= "TYPE",   
                               intensity_code = "INTENSITY",   
                               kernel_code = "KERNEL_CODE")</a></code></pre>
<p>For instance,</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="fu"><a href="../reference/mk_event_inhomogeneous_poisson.html">mk_event_inhomogeneous_poisson</a></span>(<span class="kw">type</span> <span class="kw">=</span> <span class="st">"entry"</span>,
                               <span class="kw">intensity</span> <span class="kw">=</span> <span class="st">"result = lambda*cos(t);"</span>,
                               <span class="kw">kernel_code</span> <span class="kw">=</span><span class="st">" double a_I= CNorm(20,2); 
                                             newI.set_age(a_I,t);"</span>)</pre></body></html></div>
<p>creates the same event than before, but now individuals enter the population at the rate <span class="math inline">\(\lambda \cos(t)\)</span> depending on the current time <code>t</code>.</p>
</div>
</div>
<div id="Modelcreation" class="section level2" number="2.4">
<h2 class="hasAnchor">
<a href="#Modelcreation" class="anchor"></a><span class="header-section-number">2.4</span> Model creation</h2>
<p>Finally, the IBM model is created using the function <code>mk_model</code>. The model is composed of:</p>
<ul>
<li>The characteristics names and types, which can be obtained from a population dataframe with the function <code>get_characteristics</code>,</li>
<li>The events list,</li>
<li>The model parameters.</li>
</ul>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="no">model</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mk_model.html">mk_model</a></span>(<span class="kw">characteristics</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_characteristics.html">get_characteristics</a></span>(<span class="no">pop</span>),
                  <span class="kw">event</span> <span class="kw">=</span> <span class="no">events_list</span>,
                  <span class="kw">parameters</span> <span class="kw">=</span> <span class="no">model_params</span>)</pre></body></html></div>
<p>During this step which can take a few seconds, the model is created and compiled using the Rcpp package.
One of the advantages of the model structure in IBMPopSim is that only the model only depends on the population characteristics’ and parameters names and types, rather than their values.</p>
<p>This means that once the model has been created, various simulations can be done with various initial populations and different parameters values. Thus, only one model has to be created to simulation a class of IBMs with varying parameters (see Section <a href="#Simulation1">2.5.2</a> for an example).</p>
<p>Here is an example of model with a gender characteristic and two events (birth and death):</p>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="no">params</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"p_male"</span><span class="kw">=</span> <span class="fl">0.51</span>,
               <span class="st">"birth_rate"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/stepfun.html">stepfun</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">15</span>,<span class="fl">40</span>),<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">0.05</span>,<span class="fl">0</span>)),<span class="st">"death_rate"</span><span class="kw">=</span><span class="fu"><a href="../reference/gompertz.html">gompertz</a></span>(<span class="fl">0.008</span>,<span class="fl">0.02</span>))


<span class="no">death_event</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mk_event_individual.html">mk_event_individual</a></span>(<span class="kw">type</span> <span class="kw">=</span> <span class="st">"death"</span>, <span class="kw">name</span><span class="kw">=</span> <span class="st">"my_death_event"</span>,
                  <span class="kw">intensity_code</span> <span class="kw">=</span> <span class="st">"result = death_rate(age(I,t));"</span>)

<span class="no">birth_event</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mk_event_individual.html">mk_event_individual</a></span>( <span class="kw">type</span> <span class="kw">=</span> <span class="st">"birth"</span>,
                  <span class="kw">intensity_code</span> <span class="kw">=</span> <span class="st">" if (I.male)
                                        result = 0; 
                                     else 
                                        result=birth_rate(age(I,t));"</span>,
                  <span class="kw">kernel_code</span> <span class="kw">=</span> <span class="st">"newI.male = CUnif(0, 1) &lt; p_male;"</span>)


<span class="no">model</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mk_model.html">mk_model</a></span>(<span class="kw">characteristics</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_characteristics.html">get_characteristics</a></span>(<span class="no">pop</span>),
                  <span class="kw">events</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">death_event</span>,<span class="no">birth_event</span>),
                  <span class="kw">parameters</span> <span class="kw">=</span> <span class="no">params</span>)

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">model</span>)
<span class="co">## Events:</span>
<span class="co">## #1: individual event of type death</span>
<span class="co">## #2: individual event of type birth</span>
<span class="co">## --------------------------------------- </span>
<span class="co">## Individual description:</span>
<span class="co">## names:  birth death male </span>
<span class="co">## R types:  double double logical </span>
<span class="co">## C types:  double double bool</span>
<span class="co">## --------------------------------------- </span>
<span class="co">## R parameters available in C++ code:</span>
<span class="co">## names:  p_male birth_rate death_rate </span>
<span class="co">## R types:  double closure closure </span>
<span class="co">## C types:  double function_x function_x</span></pre></body></html></div>
</div>
<div id="simulation" class="section level2" number="2.5">
<h2 class="hasAnchor">
<a href="#simulation" class="anchor"></a><span class="header-section-number">2.5</span> Simulation and outputs</h2>
<p>Once the model has been created, the random evolution of the population can be simulated over a period of time <span class="math inline">\([0,T]\)</span> by calling the function</p>
<pre class="text"><code><a href="../reference/popsim.html">popsim(model,population, events_bounds, parameters,age_max,time,...)</a></code></pre>
<p>Where:</p>
<ul>
<li>
<code>model</code> is the model created in the previous step,</li>
<li>
<code>population</code> is a population dataframe representing the initial population,</li>
<li>
<code>parameters</code> is the list of parameters value,</li>
<li>
<code>age_max</code> is the maximum age of individuals in the population (set by default to <code>Inf</code>),</li>
<li>
<code>time</code> is the final simulation time <span class="math inline">\(T\)</span> or a vector of times (see @ref(simulation_swap)),</li>
<li>
<code>events_bounds</code> is a named vector of <strong>bounds</strong> for the intensity or interaction function of each event.</li>
</ul>
<div id="algorithm-and-events-bounds" class="section level3" number="2.5.1">
<h3 class="hasAnchor">
<a href="#algorithm-and-events-bounds" class="anchor"></a><span class="header-section-number">2.5.1</span> Algorithm and events bounds</h3>
<p>The IBM simulation algorithm is based on an acceptance-rejection method for simulating random times, called thinning (<span style="color:red">donner ref</span>). The main idea of the algorithm is to simulate candidate event times with <em>constant</em> intensity <span class="math inline">\(\bar \lambda\)</span> (which is simply an exponential variable with parameter <span class="math inline">\(\lambda\)</span>), which <em>dominates</em> the true event intensity <span class="math inline">\(\lambda^e(I,t)\)</span> for all individuals <span class="math inline">\(I\)</span>:</p>
<p><span class="math display">\[\begin{equation}
\lambda^e(I,t) \leq \bar{\lambda}, \quad \forall I \in \text{pop}, \; t \in [0,T].
\end{equation}\]</span></p>
<p>Starting from time <span class="math inline">\(t\)</span>, once a candidate event time <span class="math inline">\(t + \tau^e\)</span> has been proposed for a given event <span class="math inline">\(e\)</span> and individual <span class="math inline">\(I\)</span>, it remains to accept or reject the candidate event with probability <span class="math inline">\(\frac{\lambda^e(I,t+\tau^e)}{\bar{\lambda}}\)</span>. If the candidate event is accepted, then the event <span class="math inline">\(e\)</span> occurs to the individual <span class="math inline">\(I\)</span> at time <span class="math inline">\(t + \tau^e\)</span>. The thinning algorithm can be summarized as follow:</p>
<p><strong>Thinning algorithm</strong></p>
<ol style="list-style-type: decimal">
<li>Draw a candidate time <span class="math inline">\(t+\tau^e\)</span> for event <span class="math inline">\(e\)</span>, <span class="math inline">\(\tau^e \sim \mathcal E(\bar \lambda)\)</span>.</li>
<li>Draw a uniform variable <span class="math inline">\(\theta \sim \mathcal U([0,1])\)</span>.</li>
<li>
<strong>If</strong> <span class="math inline">\(\theta \leq \dfrac{\lambda^e(I,t+\tau^e)}{\bar\lambda}\)</span> <strong>then</strong><br><span class="math inline">\(\qquad\)</span> Apply event kernel to individual <span class="math inline">\(I\)</span><br><strong>else</strong><br><span class="math inline">\(\qquad\)</span> Do nothing and start again from <span class="math inline">\(t+\tau^e\)</span>.</li>
</ol>
<p>If the intensity is of class <code>interaction</code>, the intensity function <span class="math inline">\(\lambda^e\)</span> is replaced by the interaction function <span class="math inline">\(U^e\)</span>, and <span class="math inline">\(\bar \lambda\)</span> by a bound <span class="math inline">\(\bar U^e\)</span> of <span class="math inline">\(U^e\)</span>.</p>
<p>Thus, before simulating a random path of the population evolution, the user has to specify bounds for the intensity function (resp. interaction kernel) of each event. Let us consider the model with a birth and death built in the previous section.</p>
<p>In the model, the birth intensity of an individual of age <span class="math inline">\(a\)</span> is <span class="math inline">\(0\)</span> if he is a male, and
<span class="math display">\[ b(a) = 0.005  \mathbb{1}_{[15,40]},\]</span>
if the individual is a female. Thus, the intensity bound for birth events is</p>
<p><span class="math display">\[\bar\lambda_b = \sup_{a\geq 0} \;  \text{birth\_rate}(a) = 0.05\]</span></p>
<p>Since the death intensity function is not bounded, the user will have to specify a maximum age <span class="math inline">\(a_{max}\)</span> in <code>popsim</code>. Then, the bound for death events is</p>
<p><span class="math display">\[ \bar \lambda_d = 0.008\exp(0.02 a_{max}).\]</span></p>
<p>The events bounds are defined as a <em>named</em> R vector, with components names corresponding to the events names.<br>
In our example, the event of type death has been named <code>"my_death_event"</code>. No name has been specified for the event of type birth which thus has the default name <code>"birth"</code>. Then,</p>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="no">a_max</span> <span class="kw">&lt;-</span> <span class="fl">120</span> <span class="co"># maximum age</span>
<span class="no">events_bounds</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"my_death_event"</span> <span class="kw">=</span> <span class="fl">0.008</span>*<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="fl">0.02</span>*<span class="no">a_max</span>),
                  <span class="st">"birth"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">params</span>$<span class="no">birth_rate</span>))

<span class="no">events_bounds</span>
<span class="co">## my_death_event          birth </span>
<span class="co">##     0.08818541     0.05000000</span></pre></body></html></div>
<p><span style="color:red"> Utilisation de max, renvoyer à la section C++. </span></p>
</div>
<div id="Simulation1" class="section level3" number="2.5.2">
<h3 class="hasAnchor">
<a href="#Simulation1" class="anchor"></a><span class="header-section-number">2.5.2</span> Simulation without swap events</h3>
<p>Once the model and events bounds have been defined, a random trajectory of the population can be simulated by calling</p>
<div class="sourceCode" id="cb32"><html><body><pre class="r"><span class="no">sim_out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/popsim.html">popsim</a></span>(<span class="no">model</span>, <span class="no">pop</span>, <span class="no">events_bounds</span>, <span class="no">params</span>,
                  <span class="kw">age_max</span> <span class="kw">=</span> <span class="no">a_max</span>, <span class="kw">time</span> <span class="kw">=</span> <span class="fl">30</span>)
<span class="co">## Simulation on  [0, 30]</span>
<span class="co">#str(sim_out)</span></pre></body></html></div>
<p><code>sim_out</code> is a list composed of</p>
<ul>
<li>A list <code>arguments</code> of the simulation inputs, including the initial population, parameters and event bounds.</li>
<li>A named numeric vector <code>logs</code> of variables related to the simulation algorithm.</li>
<li>The simulation output called <code>population</code>.</li>
</ul>
<p>When there are no swap events (individuals don’t change of characteristics), the evolution of the population over the period <span class="math inline">\([0,30]\)</span> is recorded in a single dataframe <code>sim_out$population</code> containing the information of all individuals who lived in the population during the period.<br>
Each line of <code>sim_out$population</code> contains the information of an individual who lived in the population over the period <span class="math inline">\([0,30]\)</span>. This includes individuals who were initially in <code>pop</code>, as well as individuals who were born or entered the population.</p>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">sim_out</span>$<span class="no">population</span>)
<span class="co">## 'data.frame':    118032 obs. of  3 variables:</span>
<span class="co">##  $ birth: num  -89.9 -89.9 -89.9 -89.9 -89.9 ...</span>
<span class="co">##  $ death: num  NA NA NA NA NA NA NA NA NA NA ...</span>
<span class="co">##  $ male : logi  TRUE TRUE FALSE FALSE FALSE TRUE ...</span></pre></body></html></div>
<p>Table <a href="#tab:logs">2.8</a> describes the elements of the vector <code>sim_out$logs</code>containing information on simulation algorithm:</p>
<table class="table">
<caption>
<span id="tab:logs">Table 2.8: </span>Logs parameters</caption>
<thead><tr class="header">
<th align="left">Elements</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>proposed_events</code></td>
<td align="left">Number of candidate event times proposed during the simulation</td>
</tr>
<tr class="even">
<td align="left"><code>effective_events</code></td>
<td align="left">Number of events which occured during the simulation</td>
</tr>
<tr class="odd">
<td align="left"><code>cleanall_counter</code></td>
<td align="left">Number of population cleans</td>
</tr>
<tr class="even">
<td align="left"><code>duration_main_algorithm</code></td>
<td align="left">Simulation time</td>
</tr>
</tbody>
</table>
<p>For instance, the acceptance rate in the toy model is</p>
<div class="sourceCode" id="cb34"><html><body><pre class="r"><span class="no">sim_out</span>$<span class="no">logs</span>[<span class="st">'effective_events'</span>]/<span class="no">sim_out</span>$<span class="no">logs</span>[<span class="st">'proposed_events'</span>]
<span class="co">## effective_events </span>
<span class="co">##        0.2181205</span></pre></body></html></div>
<p>and the simulation time is</p>
<div class="sourceCode" id="cb35"><html><body><pre class="r"><span class="no">sim_out</span>$<span class="no">logs</span>[<span class="st">'duration_main_algorithm'</span>]
<span class="co">## duration_main_algorithm </span>
<span class="co">##                0.046378</span></pre></body></html></div>
<p><strong>Parameters modification and event removal</strong></p>
<p>As explained in Section <a href="#Modelcreation">2.4</a> the structure of the compiled model allows the parameters’ values to be changed without recompiling the model. For instance, the parameter of the Gompertz death function can be modified to study the impact of an increase in mortality.<br>
Before running the simulation, the events bounds should be updated accordingly accordingly.</p>
<div class="sourceCode" id="cb36"><html><body><pre class="r"><span class="no">params</span>$<span class="no">death_rate</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/gompertz.html">gompertz</a></span>(<span class="fl">0.01</span>,<span class="fl">0.02</span>)

<span class="no">events_bounds</span>[<span class="st">"my_death_event"</span>] <span class="kw">&lt;-</span> <span class="fl">0.01</span>*<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="fl">0.02</span>*<span class="no">a_max</span>) <span class="co"># Death event bound update</span>

<span class="no">new_sim_out</span>  <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/popsim.html">popsim</a></span>(<span class="no">model</span>, <span class="no">pop</span>, <span class="no">events_bounds</span>, <span class="no">params</span>,
                  <span class="kw">age_max</span> <span class="kw">=</span> <span class="no">a_max</span>, <span class="kw">time</span> <span class="kw">=</span> <span class="fl">30</span>) <span class="co"># Population simulation </span></pre></body></html></div>
<p>An event can also be remove by setting the event bound to 0:</p>
<div class="sourceCode" id="cb37"><html><body><pre class="r"><span class="no">sim_out_no_birth</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/popsim.html">popsim</a></span>(<span class="no">model</span>, <span class="no">pop</span>, <span class="kw">events_bounds</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"birth"</span><span class="kw">=</span><span class="fl">0</span>, <span class="st">"my_death_event"</span><span class="kw">=</span> <span class="fl">0.01</span>*<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="fl">0.02</span>*<span class="no">a_max</span>)),
                                <span class="no">params</span>, <span class="kw">age_max</span> <span class="kw">=</span> <span class="no">a_max</span>, <span class="kw">time</span> <span class="kw">=</span> <span class="fl">30</span>) <span class="co"># Simulation without birth events</span>
<span class="co">## [1] "event birth is deactivated"</span>
<span class="co">## Simulation on  [0, 30]</span></pre></body></html></div>
<p><strong>Outputs</strong></p>
<p>The R dataframe format for the output of the simulation allows all data manipulation functionalities of tidyverse or data.table packages to be used for analyzing the population. IBMPopSim also provides base functions to study the simulation outputs.</p>
<p>For instance, the population age pyramid can computed at a give time (resp. at multiple dates) with the function <code>age_pyramid</code> (resp. <code>age_pyramids</code>). We refer to the other vignettes for more details on age pyramids computation and visualization.</p>
<div class="sourceCode" id="cb38"><html><body><pre class="r"><span class="no">pop_out</span> <span class="kw">&lt;-</span> <span class="no">sim_out</span>$<span class="no">population</span>

<span class="co"># Population age-pyramid at time 30:</span>
<span class="no">pyr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/age_pyramid.html">age_pyramid</a></span>(<span class="no">pop_out</span>, <span class="kw">ages</span> <span class="kw">=</span> <span class="fl">0</span>:<span class="no">a_max</span>, <span class="kw">time</span> <span class="kw">=</span> <span class="fl">30</span>)
<span class="fu"><a href="../reference/plot_pyramid.html">plot_pyramid</a></span>(<span class="no">pyr</span>)</pre></body></html></div>
<p><img src="IBMPopSim_files/figure-html/unnamed-chunk-23-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Mortality tables with compatibles with packages such as StMoMo can also be computed by with the functions <code>death_table</code> and <code>exposure_table</code>.</p>
<div class="sourceCode" id="cb39"><html><body><pre class="r"><span class="no">female_pop</span> <span class="kw">&lt;-</span> <span class="no">pop_out</span>[<span class="no">pop_out</span>$<span class="no">male</span><span class="kw">==</span><span class="fl">FALSE</span>, ]
<span class="no">Dxt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/death_table.html">death_table</a></span>(<span class="no">female_pop</span>, <span class="kw">ages</span> <span class="kw">=</span> <span class="fl">85</span>:<span class="fl">90</span>,<span class="kw">times</span> <span class="kw">=</span> <span class="fl">20</span>:<span class="fl">30</span>) <span class="co"># Death table (death age is age at death)</span>
<span class="no">Ext</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/exposure_table.html">exposure_table</a></span>(<span class="no">female_pop</span>, <span class="kw">ages</span> <span class="kw">=</span> <span class="fl">85</span>:<span class="fl">90</span>,<span class="kw">times</span> <span class="kw">=</span> <span class="fl">20</span>:<span class="fl">30</span>) <span class="co"># Exact computation of central Exposure-to-risk</span></pre></body></html></div>
<p><strong>Simple multithreading</strong></p>
<p>If there are <strong>no interactions</strong> between individuals, i.e. if there are no events with intensity of class <code>interaction</code>, then the simulation can be parallelized easily by setting the optional parameter <code>multithreading</code> (<code>FALSE</code> by default) to <code>TRUE</code>:</p>
<div class="sourceCode" id="cb40"><html><body><pre class="r"><span class="no">sim_out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/popsim.html">popsim</a></span>(<span class="no">model</span>, <span class="no">pop</span>, <span class="no">events_bounds</span>, <span class="no">params</span>,
                  <span class="kw">age_max</span> <span class="kw">=</span> <span class="no">a_max</span>, <span class="kw">time</span> <span class="kw">=</span> <span class="fl">30</span>, <span class="kw">multithreading</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<pre><code>## duration_main_algorithm 
##                0.020009</code></pre>
<p>By default, the number of threads is the number of concurrent threads supported by the available hardware implementation.<br>
The number of thread can be set manually with the optional argument <code>num_threads</code> of <code>popsim</code>.</p>
</div>
</div>
<div id="simulationswap" class="section level2" number="2.6">
<h2 class="hasAnchor">
<a href="#simulationswap" class="anchor"></a><span class="header-section-number">2.6</span> Simulation with swap events</h2>
<p>When there are swap events (individuals can change of characteristics), the dates of swap events and the individual changed characteristics following each swap event should be recorded for each individual in the population, which is a memory intensive and computationally costly process.<br>
To maintain efficient simulations in the presence of swap events, we propose the following solution:</p>
<ol style="list-style-type: decimal">
<li>Use a vector of dates <span class="math inline">\((t_0,\dots, t_n)\)</span> in the argument <code>time</code> of <code>popsim</code>. Then <code>popsim</code> returns in the object <code>population</code> a list of <span class="math inline">\(n\)</span> population dataframes representing the population at time <span class="math inline">\(t_1,\dots t_n\)</span>, simulated from the initial time <span class="math inline">\(t_0\)</span>.<br>
For <span class="math inline">\(i=1\dots n\)</span>, the <span class="math inline">\(i\)</span>th dataframe describes individuals who lived in the population during the period <span class="math inline">\([t_0,t_i]\)</span>, with their characteristics at time <span class="math inline">\(t_i\)</span>.</li>
</ol>
<p>In the following toy model, a population 100 thousand individuals (or particles) is generated, all born at time 0 and divided into two subgroups. Individuals can swap from subgroup 1 (resp. 2) to subgroup 2 (resp. 1) at rate 0.1 (resp. 0.3).</p>
<div class="sourceCode" id="cb42"><html><body><pre class="r"><span class="no">pop</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="st">"birth"</span><span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>,<span class="fl">1e5</span>),<span class="st">"death"</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">NA</span>,<span class="fl">1e5</span>),
                         <span class="st">"sub_grp"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fl">1</span>:<span class="fl">2</span>, <span class="fl">1e5</span>, <span class="kw">replace</span> <span class="kw">=</span> <span class="fl">TRUE</span>))

<span class="no">rates</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>( <span class="kw">k12</span> <span class="kw">=</span> <span class="fl">0.1</span>, <span class="kw">k21</span><span class="kw">=</span><span class="fl">0.3</span>)
<span class="co">#Only swap events occur in the population</span>
<span class="no">swap_event</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mk_event_individual.html">mk_event_individual</a></span>( <span class="kw">type</span> <span class="kw">=</span> <span class="st">"swap"</span>,
                  <span class="kw">intensity_code</span> <span class="kw">=</span> <span class="st">"if (I.sub_grp==1) result= k12 ; 
                                    else result= k21;"</span>,
                  <span class="kw">kernel_code</span> <span class="kw">=</span> <span class="st">"I.sub_grp = 3 - I.sub_grp;"</span>)

<span class="no">model_swap</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mk_model.html">mk_model</a></span>(<span class="kw">characteristics</span> <span class="kw">=</span><span class="fu"><a href="../reference/get_characteristics.html">get_characteristics</a></span>(<span class="no">pop</span>), <span class="kw">events</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">swap_event</span>),<span class="kw">parameters</span> <span class="kw">=</span> <span class="no">rates</span>)</pre></body></html></div>
<p>Then, the population is simulated from <span class="math inline">\(t_0=0\)</span> to <span class="math inline">\(t_n =20\)</span>, and <code>popsim</code> returns a list of 20 data frames composed of the population at times <span class="math inline">\(t=1\dots 20\)</span>.</p>
<div class="sourceCode" id="cb43"><html><body><pre class="r"><span class="no">time_vec</span> <span class="kw">&lt;-</span> <span class="fl">1</span>:<span class="fl">20</span>

<span class="no">sim_out</span> <span class="kw">&lt;-</span><span class="fu"><a href="../reference/popsim.html">popsim</a></span>(<span class="kw">model</span> <span class="kw">=</span> <span class="no">model_swap</span>, <span class="kw">population</span> <span class="kw">=</span> <span class="no">pop</span>,
                 <span class="kw">events_bounds</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"swap"</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">rates</span>))),
                 <span class="kw">parameters</span> <span class="kw">=</span>  <span class="no">rates</span>, <span class="kw">time</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="no">time_vec</span>),
                 <span class="kw">multithreading</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p>The model is an ergodic two states continuous time Markov chain with stationary distribution <span class="math inline">\((p_1,p_2)=(0,75,0.25)\)</span>. The figure below illustrates the convergence of the probability to be in subgroup 1 to <span class="math inline">\(p_1\)</span></p>
<div class="sourceCode" id="cb44"><html><body><pre class="r"><span class="no">pop_size</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">pop</span>)
<span class="co"># Mean number of individuals in subgroup 1 at each time:</span>
<span class="no">p_1_t</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">sim_out</span>$<span class="no">population</span>, <span class="kw">function</span>(<span class="no">pop_df</span>){
                      <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">pop_df</span>, <span class="no">sub_grp</span><span class="kw">==</span><span class="fl">1</span>))/<span class="no">pop_size</span>)
                })</pre></body></html></div>
<div class="figure" style="text-align: center">
<span id="fig:plot"></span>
<img src="IBMPopSim_files/figure-html/plot-1.png" alt="Evolution of probability to be in subgroup 1" width="672"><p class="caption">
Figure 2.1: Evolution of probability to be in subgroup 1
</p>
</div>
<p>This example shows that any continuous time Markov Chain with finite state space can be simulated in a few steps with IBMPopSim.</p>
<ol start="2" style="list-style-type: decimal">
<li>[Optional] Activate the optional argument <code>with_id</code> during the model creation step.</li>
</ol>
<p>It is possible to isolate the individuals’ life course, by setting the optional argument <code>with_id</code> of <code>mk_model</code> to <code>TRUE</code>. In this case, a new characteristic called <code>id</code> is added to the population (if not already defined), identifying each individual with a unique integer.</p>
<div class="sourceCode" id="cb45"><html><body><pre class="r"><span class="no">model_swap_id</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mk_model.html">mk_model</a></span>(<span class="kw">characteristics</span> <span class="kw">=</span>  <span class="fu"><a href="../reference/get_characteristics.html">get_characteristics</a></span>(<span class="no">pop</span>), <span class="kw">events</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">swap_event</span>),
                          <span class="kw">parameters</span> <span class="kw">=</span> <span class="no">rates</span>, <span class="kw">with_id</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co">## [1] "add 'id' as individual attributes"</span></pre></body></html></div>
<div class="sourceCode" id="cb46"><html><body><pre class="r"><span class="no">sim_out_id</span> <span class="kw">&lt;-</span><span class="fu"><a href="../reference/popsim.html">popsim</a></span>(<span class="kw">model</span> <span class="kw">=</span> <span class="no">model_swap_id</span>,
                    <span class="kw">population</span> <span class="kw">=</span> <span class="no">pop</span>,
                    <span class="kw">parameters</span> <span class="kw">=</span> <span class="no">rates</span>,
                    <span class="kw">events_bounds</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"swap"</span><span class="kw">=</span><span class="fl">0.3</span>),
                    <span class="kw">time</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>,<span class="fl">5</span>, <span class="kw">by</span><span class="kw">=</span><span class="fl">1</span>),
                    <span class="kw">multithreading</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co">## [1] "Add 'id' attributes to the population."</span>
<span class="co">## Simulation on  [0, 1]  [1, 2]  [2, 3]  [3, 4]  [4, 5]</span></pre></body></html></div>
<div class="sourceCode" id="cb47"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">sim_out_id</span>$<span class="no">population</span><span class="kw">[[</span><span class="fl">1</span>]])
<span class="co">##   id birth death sub_grp</span>
<span class="co">## 1  1     0    NA       1</span>
<span class="co">## 2  5     0    NA       2</span>
<span class="co">## 3  9     0    NA       2</span>
<span class="co">## 4 13     0    NA       2</span>
<span class="co">## 5 17     0    NA       2</span>
<span class="co">## 6 21     0    NA       1</span></pre></body></html></div>
<p>These dataframes can be merged into a single dataframe summarizing the life course of each individual, by calling the function <code>merge_pop_withid</code>.</p>
<div class="sourceCode" id="cb48"><html><body><pre class="r"><span class="no">pop_list</span> <span class="kw">&lt;-</span> <span class="no">sim_out_id</span>$<span class="no">population</span>
<span class="no">pop_merge</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/merge_pop_withid.html">merge_pop_withid</a></span>(<span class="no">pop_list</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">pop_merge</span>)
<span class="co">##   id birth death sub_grp_1 sub_grp_2 sub_grp_3 sub_grp_4 sub_grp_5</span>
<span class="co">## 1  1     0    NA         1         1         1         1         1</span>
<span class="co">## 2  5     0    NA         2         1         1         1         1</span>
<span class="co">## 3  9     0    NA         2         2         1         2         2</span>
<span class="co">## 4 13     0    NA         2         2         2         1         1</span>
<span class="co">## 5 17     0    NA         2         1         1         1         1</span>
<span class="co">## 6 21     0    NA         1         2         1         1         1</span></pre></body></html></div>
<p>For instance, a transition from subgroup 1 to subgroup 2 is observed for the individual with <code>id</code> number 5, between time 2 and 3.</p>
</div>
</div>
<div id="essentials" class="section level1" number="3">
<h1 class="hasAnchor">
<a href="#essentials" class="anchor"></a><span class="header-section-number">3</span> C++ essentials</h1>
<p>The arguments <code>intensity_code</code>, <code>interaction_code</code> and <code>kernel_code</code> of the events functions must contain some C++ code given by the user. You don’t need to be a C++ guru to write the few instructions needed. These functions should use very little C++ syntax. They are essentially arithmetic or logical operations, tests and calls to predefined functions.</p>
<p>For code efficiency, you should not allocate memory in these functions (no <code>new</code>) or use type containers (<code>std::vector</code>, <code>std::list</code>, …). If you think you need to allocate memory, consider as parameter an R vector that will be mapped via <code>arma::vector</code> (see below), or declare the variable as <code>static</code>.
Also, it should not be necessary to make a loop. Keep in mind that these functions should be fast.</p>
<p>There are no C++ language restrictions so you can use all the functions of the standard C++11 library. However we detail in this section some functions that should be sufficient.</p>
<div id="c-syntax" class="section level2" number="3.1">
<h2 class="hasAnchor">
<a href="#c-syntax" class="anchor"></a><span class="header-section-number">3.1</span> C++ syntax</h2>
<ul>
<li>Each statement must be ended by a semicolon.</li>
<li>Single-line comments start with two forward slashes <code>//</code>.</li>
<li>To create a variable, you must specify the type and assign it a value (type variable = value;). Here some examples:</li>
</ul>
<pre><code>int myNum = 5;               // Integer (whole number without decimals)
double myFloatNum = 5.99;    // Floating point number (with decimals)
char myLetter = 'D';         // Character
bool myBoolean = true;       // Boolean (true or false)</code></pre>
<ul>
<li>
<code>bool</code> data type can take the values <code>true</code> (1) or <code>false</code> (0).</li>
<li>C++ supports the usual logical conditions from mathematics:
<ul>
<li>Less than: <code>a &lt; b</code>
</li>
<li>Less than or equal to: <code>a &lt;= b</code>
</li>
<li>Greater than: <code>a &gt; b</code>
</li>
<li>Greater than or equal to: <code>a &gt;= b</code>
</li>
<li>Equal to <code>a == b</code>
</li>
<li>Not Equal to: <code>a != b</code>
</li>
</ul>
</li>
<li>The logical operators are: <code>!</code>, <code>&amp;&amp;</code>, <code>||</code>
</li>
<li>The arithmetic operators are: <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>, <code><a href="https://rdrr.io/r/base/Arithmetic.html">-</a></code>, <code><a href="https://rdrr.io/r/base/Arithmetic.html">*</a></code>, <code><a href="https://rdrr.io/r/base/Arithmetic.html">/</a></code>, <code>%</code>
</li>
<li>Compound assignment: <code>+=</code>, <code>-=</code>, <code>*=</code>, <code>/=</code>, <code>%=</code>
</li>
<li>Increment and decrement: <code>++</code>, <code>--</code>
</li>
<li>Conditional ternary operator: <code>? :</code>
The conditional operator evaluates an expression, returning one value if that expression evaluates to <code>true</code>, and a different one if the expression evaluates as <code>false</code>. Its syntax is:</li>
</ul>
<pre><code>condition ? result1 : result2</code></pre>
<ul>
<li>Use the <code>if</code>, <code>else if</code>, <code>else</code> statements to specify a block of C++ code to be executed if one or more conditions are or not <code>true</code>.</li>
</ul>
<pre><code>if (condition1) {
  // block of code to be executed if condition1 is true
} else if (condition2) {
  // block of code to be executed if the condition1 is false and condition2 is true
} else {
  // block of code to be executed if the condition1 is false and condition2 is false
}</code></pre>
<ul>
<li>The syntax of the switch statement is a bit peculiar. Its purpose is to check for a value among a number of possible constant expressions. It is something similar to concatenating <code>if-else</code> statements, but limited to constant expressions. Its most typical syntax is:</li>
</ul>
<pre><code>switch (expression)
{
  case constant1:
     group-of-statements-1;
     break;
  case constant2:
     group-of-statements-2;
     break;
  .
  .
  .
  default:
     default-group-of-statements
}</code></pre>
<p>It works in the following way: switch evaluates expression and checks if it is equivalent to <code>constant1</code>; if it is, it executes <code>group-of-statements-1</code> until it finds the <code>break</code> statement. When it finds this break statement, the program jumps to the end of the entire switch statement (the closing brace).
- When you know exactly how many times you want to loop through a block of code, use the <code>for</code> loop.</p>
<pre><code>for (statement 1; statement 2; statement 3) {
  // code block to be executed
}</code></pre>
<ul>
<li>The while loop loops through a block of code as long as a specified condition is true.</li>
</ul>
<pre><code>while (condition) {
  // code block to be executed
}</code></pre>
<p>For more details we recommend a few pages of <a href="https://www.cplusplus.com/">www.cplusplus.com</a> about:</p>
<ul>
<li><a href="https://www.cplusplus.com/doc/tutorial/variables/">Variables</a></li>
<li><a href="https://www.cplusplus.com/doc/tutorial/operators/">Operators</a></li>
<li><a href="https://www.cplusplus.com/doc/tutorial/control/">Statements</a></li>
</ul>
</div>
<div id="usual-numeric-functions" class="section level2" number="3.2">
<h2 class="hasAnchor">
<a href="#usual-numeric-functions" class="anchor"></a><span class="header-section-number">3.2</span> Usual numeric functions</h2>
<p>The most popular functions of the <code>cmath</code> library, which is included in the package, are listed in the table below. If the user wants to call some other functions of <code>cmath</code> not listed in the table, this is possible by adding the prefix <code>std::</code> to the name of the function (scope resolution operator <code>::</code> to access to functions declared in namespace standard <code>std</code>).</p>
<p>Note that these functions are not vectorial. In the following table, the variables <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span> and <span class="math inline">\(x\)</span> are scalar.</p>
<center>
<table class="table">
<thead><tr class="header">
<th>Function call</th>
<th>Meaning</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>max(a,b)</td>
<td><span class="math inline">\(\max(a,b)\)</span></td>
</tr>
<tr class="even">
<td>min(a,b)</td>
<td><span class="math inline">\(\min(a,b)\)</span></td>
</tr>
<tr class="odd">
<td>log(x)</td>
<td><span class="math inline">\(\ln(x)\)</span></td>
</tr>
<tr class="even">
<td>exp(x)</td>
<td><span class="math inline">\(e^x\)</span></td>
</tr>
<tr class="odd">
<td>sin(x)</td>
<td><span class="math inline">\(\sin(x)\)</span></td>
</tr>
<tr class="even">
<td>cos(x)</td>
<td><span class="math inline">\(\cos(x)\)</span></td>
</tr>
<tr class="odd">
<td>pow(x,a)</td>
<td><span class="math inline">\(x^a\)</span></td>
</tr>
<tr class="even">
<td>sqrt(x)</td>
<td><span class="math inline">\(\sqrt{x}\)</span></td>
</tr>
<tr class="odd">
<td>abs(x)</td>
<td><span class="math inline">\(|x|\)</span></td>
</tr>
<tr class="even">
<td>ceil(x)</td>
<td><span class="math inline">\(\lceil x \rceil\)</span></td>
</tr>
<tr class="odd">
<td>floor(x)</td>
<td><span class="math inline">\(\lfloor x \rfloor\)</span></td>
</tr>
</tbody>
</table>
</center>
</div>
<div id="link-between-r-and-c-characteristics-and-parameters" class="section level2" number="3.3">
<h2 class="hasAnchor">
<a href="#link-between-r-and-c-characteristics-and-parameters" class="anchor"></a><span class="header-section-number">3.3</span> Link between R and C++ (characteristics and parameters)</h2>
<div id="scalar-types-characteristics-and-parameters" class="section level3" number="3.3.1">
<h3 class="hasAnchor">
<a href="#scalar-types-characteristics-and-parameters" class="anchor"></a><span class="header-section-number">3.3.1</span> Scalar types (characteristics and parameters)</h3>
</div>
<div id="vectors-and-matrices-parameters" class="section level3" number="3.3.2">
<h3 class="hasAnchor">
<a href="#vectors-and-matrices-parameters" class="anchor"></a><span class="header-section-number">3.3.2</span> Vectors and matrices (parameters)</h3>
<p>Two of the possible parameters types given in the argument <code>parameters</code> of the <code>mk_model</code> function are R vectors and R matrices. We call R vector a <code>numeric</code> of length at least 2. These types are converted, using the <a href="http://dirk.eddelbuettel.com/code/rcpp.armadillo.html">RcppArmadillo library</a>, in C++ <a href="http://arma.sourceforge.net/">Armadillo</a> types, <code>arma::vec</code> and <code>arma::matrix</code> respectively.</p>
<p>The classes <code>arma::vec</code> and <code>arma::matrix</code> are rich and easy-to-use implementations of one-dimensional and two-dimensional arrays. To access to individual elements, use the operator <code>()</code> (or <code>[]</code> in dimension 1).</p>
<ul>
<li>
<code>(n)</code> or <code>[n]</code> for <code>arma::vec</code>, access the n-th element.</li>
<li>
<code>(i,j)</code> for <code>arma::matrix</code>, access the element stored at the <span class="math inline">\(i\)</span>-th row and <span class="math inline">\(j\)</span>-th column.</li>
</ul>
<p><strong>Warning:</strong> The first element of the array is indexed by subscript of 0 (in each dimension).</p>
<p>Another standard way (in C++) to access elements is to used iterators. An iterator is an object that, pointing to some element in a range of elements, has the ability to iterate through the elements of that range using a set of operators.</p>
<p>Let <code>v</code> be a an object of type <code>arma::vec</code> and A be a an object of type <code>arma::matrix</code>. Here we show how to get the begin and the end iterators of these objects.</p>
<ul>
<li>
<code>v.begin()</code>: iterator pointing to the begin of <code>v</code>
</li>
<li>
<code>v.end()</code>: iterator pointing to the end of <code>v</code>
</li>
<li>
<code>A.begin_row(i)</code>: iterator pointing to the first element of row <code>i</code>
</li>
<li>
<code>A.end_row(i)</code>: iterator pointing to the last element of row <code>i</code>
</li>
<li>
<code>A.begin_col(i)</code>: iterator pointing to the first element of column <code>i</code>
</li>
<li>
<code>A.end_col(i)</code>: iterator pointing to the last element of column <code>i</code>
</li>
</ul>
</div>
<div id="functions-parameters" class="section level3" number="3.3.3">
<h3 class="hasAnchor">
<a href="#functions-parameters" class="anchor"></a><span class="header-section-number">3.3.3</span> Functions (parameters)</h3>
<p>To facilitate the implementation of intensity functions, R functions and their C++ equivalents have been programmed. The goal is to make the use as transparent as possible.</p>
<div id="real-functions-of-one-variable" class="section level4" number="3.3.3.1">
<h4 class="hasAnchor">
<a href="#real-functions-of-one-variable" class="anchor"></a><span class="header-section-number">3.3.3.1</span> Real functions of one variable</h4>
</div>
<div id="piecewise-real-functions-of-two-variables" class="section level4" number="3.3.3.2">
<h4 class="hasAnchor">
<a href="#piecewise-real-functions-of-two-variables" class="anchor"></a><span class="header-section-number">3.3.3.2</span> Piecewise real functions of two variables</h4>
</div>
<div id="list-of-functions" class="section level4" number="3.3.3.3">
<h4 class="hasAnchor">
<a href="#list-of-functions" class="anchor"></a><span class="header-section-number">3.3.3.3</span> List of functions</h4>
</div>
</div>
</div>
<div id="random" class="section level2" number="3.4">
<h2 class="hasAnchor">
<a href="#random" class="anchor"></a><span class="header-section-number">3.4</span> Random</h2>
<p>We use the following notations to describe the available C++ random distributions.</p>
<ul>
<li><p><span class="math inline">\(\mathcal{U}(a,b)\)</span> : Uniform distribution on <span class="math inline">\([a, b]\)</span> with <span class="math inline">\(a &lt; b\)</span></p></li>
<li><p><span class="math inline">\(\mathcal{E}(\lambda)\)</span> : Exponential distribution, <span class="math inline">\(\lambda &gt; 0\)</span></p></li>
<li><p><span class="math inline">\(\mathcal{N}(\mu,\sigma)\)</span> : Gaussian distribution, <span class="math inline">\(\mu, \sigma \in \mathbf{R}\)</span></p></li>
<li><p><span class="math inline">\(\mathrm{Pois}(\lambda)\)</span>: Poisson distribution, <span class="math inline">\(\lambda &gt; 0\)</span></p></li>
<li><p><span class="math inline">\(\Gamma(\alpha, \beta)\)</span>: Gamma distribution, <span class="math inline">\(\alpha &gt; 0\)</span>, <span class="math inline">\(\beta &gt; 0\)</span></p></li>
<li><p><span class="math inline">\(\mathrm{Weib}(a, b)\)</span>: Weibull distribution, <span class="math inline">\(a &gt; 0\)</span>, <span class="math inline">\(b &gt; 0\)</span></p></li>
<li><p><span class="math inline">\(\mathcal{U}\{a, b\}\)</span>: Discrete uniform distribution on <span class="math inline">\(\{a, a+1, \dots, b\}\)</span> with <span class="math inline">\(a &lt; b\)</span></p></li>
<li><p><span class="math inline">\(\mathcal{B}(p)\)</span>: Bernoulli distribution, the probability of success is <span class="math inline">\(p \in (0,1)\)</span></p></li>
<li><p><span class="math inline">\(\mathcal{B}(n, p)\)</span>: Binomial distribution <span class="math inline">\(n \ge 1\)</span>, <span class="math inline">\(p \in (0,1)\)</span></p></li>
<li><p><span class="math inline">\(\mathcal{D}_n\)</span> : Discrete distribution with values in <span class="math inline">\(\{ 0, \dots, n-1 \}\)</span> and with probabilities <span class="math inline">\(\{p_0, \dots, p_{n-1}\}\)</span>.</p></li>
</ul>
<p>In the table below we show how to call them, which means how to make independent realizations of these random variables, and we give the reference to the C++ corresponding function of the <a href="http://www.cplusplus.com/reference/random/">random library</a> hidden in this call.</p>
<center>
<table class="table">
<thead><tr class="header">
<th>Function call</th>
<th>Meaning</th>
<th>C++ <a href="http://www.cplusplus.com/reference/random/"><code>random</code></a> internal function</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>CUnif(<span class="math inline">\(a=0, b=1\)</span>)</td>
<td><span class="math inline">\(\mathcal{U}(a,b)\)</span></td>
<td><a href="http://www.cplusplus.com/reference/random/uniform_real_distribution/"><code>uniform_real_distribution&lt;double&gt;</code></a></td>
</tr>
<tr class="even">
<td>CExp(<span class="math inline">\(\lambda=1\)</span>)</td>
<td><span class="math inline">\(\mathcal{E}(\lambda)\)</span></td>
<td><a href="http://www.cplusplus.com/reference/random/exponential_distribution/"><code>exponential_distribution&lt;double&gt;</code></a></td>
</tr>
<tr class="odd">
<td>CNorm(<span class="math inline">\(\mu=0, \sigma=1\)</span>)</td>
<td><span class="math inline">\(\mathcal{N}(\mu,\sigma)\)</span></td>
<td><a href="http://www.cplusplus.com/reference/random/normal_distribution/"><code>normal_distribution&lt;double&gt;</code></a></td>
</tr>
<tr class="even">
<td>CPoisson(<span class="math inline">\(\lambda=1\)</span>)</td>
<td><span class="math inline">\(\mathrm{Pois}(\lambda)\)</span></td>
<td><a href="http://www.cplusplus.com/reference/random/poisson_distribution/"><code>poisson_distribution&lt;double&gt;</code></a></td>
</tr>
<tr class="odd">
<td>CGamma(<span class="math inline">\(\alpha=1, \beta=1\)</span>)</td>
<td><span class="math inline">\(\Gamma(\alpha,\beta)\)</span></td>
<td><a href="http://www.cplusplus.com/reference/random/gamma_distribution/"><code>gamma_distribution&lt;double&gt;</code></a></td>
</tr>
<tr class="even">
<td>CWeibull(<span class="math inline">\(a=1\)</span>, <span class="math inline">\(b=1\)</span>)</td>
<td><span class="math inline">\(\mathrm{Weib}(a,b)\)</span></td>
<td><a href="http://www.cplusplus.com/reference/random/weibull_distribution/"><code>weibull_distribution&lt;double&gt;</code></a></td>
</tr>
<tr class="odd">
<td>CUnifInt(<span class="math inline">\(a=0, b=2^{31}-1\)</span>)</td>
<td><span class="math inline">\(\mathcal{U}\{a,b\}\)</span></td>
<td><a href="http://www.cplusplus.com/reference/random/uniform_int_distribution/"><code>uniform_int_distribution&lt;int&gt;</code></a></td>
</tr>
<tr class="even">
<td>CBern(<span class="math inline">\(p=0.5\)</span>)</td>
<td><span class="math inline">\(\mathcal{B}(p)\)</span></td>
<td><a href="http://www.cplusplus.com/reference/random/bernoulli_distribution/"><code>bernoulli_distribution</code></a></td>
</tr>
<tr class="odd">
<td>CBinom(<span class="math inline">\(n=1, p=0.5\)</span>)</td>
<td><span class="math inline">\(\mathcal{B}(n,p)\)</span></td>
<td><a href="http://www.cplusplus.com/reference/random/binomial_distribution/"><code>binomial_distribution&lt;int&gt;</code></a></td>
</tr>
<tr class="even">
<td>CDiscrete(<code>p_begin</code>, <code>p_end</code>)</td>
<td><span class="math inline">\(\mathcal{D}_n\)</span></td>
<td><a href="http://www.cplusplus.com/reference/random/discrete_distribution/"><code>discrete_distribution&lt;int&gt;</code></a></td>
</tr>
</tbody>
</table>
</center>
<p>In the discrete distribution call <code>CDiscrete(p_begin, p_end)</code>, the arguments <code>p_begin</code> and <code>p_end</code> represent the iterators to the begin and to the end of an array which contains <span class="math inline">\(\{p_0, \dots, p_{n-1}\}\)</span>. Note that the use of iterators is a convenient and fast way to access a column or row of a matrix <code>arma::mat</code>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Daphné Giorgi, Sarah Kakaai, Vincent Lemaire.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>

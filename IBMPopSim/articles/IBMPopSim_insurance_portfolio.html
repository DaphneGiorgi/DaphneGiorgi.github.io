<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Insurance portfolio • IBMPopSim</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Insurance portfolio">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">IBMPopSim</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>

  </a>
</li>
<li>
  <a href="../articles/IBMPopSim.html">Package description</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/IBMPopSim_cpp.html">C++ essentials</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/IBMPopSim_human_pop.html">Human population</a>
    </li>
    <li>
      <a href="../articles/IBMPopSim_human_pop_IMD.html">Human population with swap</a>
    </li>
    <li>
      <a href="../articles/IBMPopSim_insurance_portfolio.html">Insurance portfolio</a>
    </li>
    <li>
      <a href="../articles/IBMPopSim_interaction.html">Population with genetically variable traits</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/daphnegiorgi/IBMPopSim/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Insurance portfolio</h1>
                        <h4 data-toc-skip class="author">Daphné Giorgi, Sarah Kaakai, Vincent Lemaire</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/DaphneGiorgi/IBMPopSim/blob/HEAD/vignettes/IBMPopSim_insurance_portfolio.Rmd" class="external-link"><code>vignettes/IBMPopSim_insurance_portfolio.Rmd</code></a></small>
      <div class="hidden name"><code>IBMPopSim_insurance_portfolio.Rmd</code></div>

    </div>

    
    
<p>This vignette provides an example of usage of the package <code>IBMPopSim</code>, for simulating an heterogeneous life insurance portfolio.</p>
<p>See <code><a href="../articles/IBMPopSim.html">vignette('IBMPopSim')</a></code> for a detailed presentation of the package.</p>
<div class="section level2" number="1">
<h2 id="example-description">
<span class="header-section-number">1</span> Example description<a class="anchor" aria-label="anchor" href="#example-description"></a>
</h2>
<p>We consider an insurance portfolio composed of males policyholders, characterized by their age and risk class (for instance smokers vs non smokers).</p>
<p>Entries to the portfolio are modeled by Poissonian events, and individuals can die or exit the portfolio with an intensity depending on their age and risk class.</p>
</div>
<div class="section level2" number="2">
<h2 id="population-creation">
<span class="header-section-number">2</span> Population creation<a class="anchor" aria-label="anchor" href="#population-creation"></a>
</h2>
<p>We start with an initial population of 10 000 males of age 65, distributed uniformly in each risk class.</p>
<p>The population data frame has thus the two (mandatory) columns:</p>
<ul>
<li>
<code>birth</code> : Date of birth of the policyholders (here the initial time is <span class="math inline">\(t_0=0\)</span>).</li>
<li>
<code>death</code>: Date of death (<code>NA</code> if alive).</li>
</ul>
<p>and the column <code>risk_cls</code> corresponding to the policyholders risk class.</p>
<p>Since individuals are free to get or interrupt a life insurance at any time, in this type of population there are entry and exit events, hence we create the population with the flags ‘entry and ’out’ set to <code>TRUE</code>. This will create 2 additional columns in the population for recording entry and exit events. At creation, <code>entry</code> values are set to <code>NA</code> and <code>out</code> values are set to <code>FALSE</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">30000</span></span>
<span><span class="va">pop_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"birth"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">65</span>,<span class="va">N</span><span class="op">)</span>,<span class="st">"death"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="va">N</span><span class="op">)</span>,<span class="st">"risk_cls"</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,each<span class="op">=</span> <span class="va">N</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pop_init</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/population.html">population</a></span><span class="op">(</span><span class="va">pop_df</span>, entry<span class="op">=</span><span class="cn">TRUE</span>, out<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2" number="3">
<h2 id="model-parameters">
<span class="header-section-number">3</span> Model parameters<a class="anchor" aria-label="anchor" href="#model-parameters"></a>
</h2>
<div class="section level3" number="3.1">
<h3 id="death-intensity">
<span class="header-section-number">3.1</span> Death intensity<a class="anchor" aria-label="anchor" href="#death-intensity"></a>
</h3>
<p>Death intensities are calibrated on England and Wales (EW) males mortality data (source: Human Mortality Database), and forecasted over t=30 years by a Lee-Carter model with the package <code>StMoMo</code>.
Individuals in the risk class 1 are assumed to have mortality rates 20% higher that the forecasted mortality rates and individuals in the risk class 2 are assumed to have mortality rates 20% lower than the forecasted rates. The death intensity of a individual in risk class <span class="math inline">\(i=1,2\)</span> is thus the function</p>
<p><span class="math display" id="eq:deathrates">\[\begin{equation}
\tag{3.1} d^i(t,a)= \alpha_i \sum_{k=0}^{29}\mathbf{1}_{\{k\leq t &lt; k+1\}} d_k(a), \quad \alpha_1 = 1.2, \quad \alpha_2 = 0.8,
\end{equation}\]</span></p>
<p>and where <span class="math inline">\(d_k(a)\)</span> is the point estimate of the mortality rate for age <span class="math inline">\(a\)</span> and year <span class="math inline">\(2017 + k\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EWStMoMoMale</span> <span class="op">&lt;-</span> <span class="fu">StMoMoData</span><span class="op">(</span><span class="va">EWdata_hmd</span>, series <span class="op">=</span> <span class="st">"male"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Fitting</span></span>
<span><span class="va">LC</span> <span class="op">&lt;-</span> <span class="fu">lc</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">ages.fit</span> <span class="op">&lt;-</span> <span class="fl">65</span><span class="op">:</span><span class="fl">100</span></span>
<span><span class="va">years.fit</span> <span class="op">&lt;-</span> <span class="fl">1950</span><span class="op">:</span><span class="fl">2016</span></span>
<span><span class="va">LCfitMale</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">LC</span>, data <span class="op">=</span> <span class="va">EWStMoMoMale</span>, ages.fit <span class="op">=</span> <span class="va">ages.fit</span>, years.fit <span class="op">=</span> <span class="va">years.fit</span><span class="op">)</span></span>
<span><span class="co">## StMoMo: Start fitting with gnm</span></span>
<span><span class="co">## Initialising</span></span>
<span><span class="co">## Running start-up iterations..</span></span>
<span><span class="co">## Running main iterations.....</span></span>
<span><span class="co">## Done</span></span>
<span><span class="co">## StMoMo: Finish fitting with gnm</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span><span class="va">LCforecastMale</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="op">(</span><span class="va">LCfitMale</span>, h <span class="op">=</span> <span class="va">t</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">LCforecastMale</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<p><img src="insur_forecast-1.png" width="70%" style="display: block; margin: auto;"></p>
</div>
<p>Age and time dependent function can be created with the package function <code><a href="../reference/piecewise_xy.html">?piecewise_xy</a></code>, with allows to define age-specific mortality rates, piecewise constant in time, such as <span class="math inline">\(d^i\)</span> in <a href="#eq:deathrates">(3.1)</a>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">LCforecastMale</span><span class="op">$</span><span class="va">rates</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/stepfun.html">stepfun</a></span><span class="op">(</span><span class="fl">66</span><span class="op">:</span><span class="fl">100</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">breaks</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">29</span></span>
<span><span class="va">death_male</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/piecewise_xy.html">piecewise_xy</a></span><span class="op">(</span><span class="va">breaks</span>,<span class="va">d_k</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">death_male</span><span class="op">(</span><span class="fl">10</span>,<span class="fl">65</span><span class="op">)</span> <span class="co"># Death rate at time t=10 (years 2027) and age 60.</span></span>
<span><span class="co">## [1] 0.009082013</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"death_male"</span> <span class="op">=</span> <span class="va">death_male</span>, <span class="st">"alpha"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.3</span>,<span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" number="3.2">
<h3 id="exit-events">
<span class="header-section-number">3.2</span> Exit events<a class="anchor" aria-label="anchor" href="#exit-events"></a>
</h3>
<p>Individuals exit the portfolio at a rate <span class="math inline">\(\mu^{i}\)</span>, <span class="math inline">\(i=1,2\)</span> depending on their risk class.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span><span class="op">$</span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.001</span>,<span class="fl">0.06</span><span class="op">)</span> <span class="co"># Exit event rate</span></span></code></pre></div>
</div>
<div class="section level3" number="3.3">
<h3 id="entry-events">
<span class="header-section-number">3.3</span> Entry events<a class="anchor" aria-label="anchor" href="#entry-events"></a>
</h3>
<p>Entry events occur at a Poissonian (constant) rate <span class="math inline">\(\lambda\)</span> (in average <span class="math inline">\(\lambda\)</span> individuals enter the population each year).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span><span class="op">$</span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">30000</span> <span class="co"># Entry events</span></span></code></pre></div>
</div>
</div>
<div class="section level2" number="4">
<h2 id="events-creation">
<span class="header-section-number">4</span> Events creation<a class="anchor" aria-label="anchor" href="#events-creation"></a>
</h2>
<div class="section level3" number="4.1">
<h3 id="death-events-creation">
<span class="header-section-number">4.1</span> Death events creation<a class="anchor" aria-label="anchor" href="#death-events-creation"></a>
</h3>
<p>The vector parameter <code>alpha</code> will be transformed into a C++ vector (with index starting at 0) during the model creation, and <code>death_male</code> into a C++ function.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">death_event</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mk_event_individual.html">mk_event_individual</a></span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="st">"death"</span>,</span>
<span>    intensity_code <span class="op">=</span> <span class="st">"result = alpha[I.risk_cls-1] * death_male(t,age(I, t));"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" number="4.2">
<h3 id="exit-events-creation">
<span class="header-section-number">4.2</span> Exit events creation<a class="anchor" aria-label="anchor" href="#exit-events-creation"></a>
</h3>
<p>Each individual in the portfolio can exit the portfolio at a constant (individual) rate <span class="math inline">\(\mu^i\)</span> depending on their risk class.</p>
<p>In the presence of events of type <code>exit</code>, the population must have a characteristic named <code>out</code>, which is set to <code>FALSE</code> by default (see function ‘?population’).
When an individual leaves the population, his characteristic <code>out</code> is set to <code>TRUE</code> and the date at which he exited the population is recorded in the column <code>death</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exit_event</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mk_event_individual.html">mk_event_individual</a></span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="st">"exit"</span>,</span>
<span>    intensity <span class="op">=</span> <span class="st">"result = mu[I.risk_cls-1]; "</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" number="4.3">
<h3 id="entry-event-creation">
<span class="header-section-number">4.3</span> Entry event creation<a class="anchor" aria-label="anchor" href="#entry-event-creation"></a>
</h3>
<p>New policyholders enter the population at a constant rate <span class="math inline">\(\lambda\)</span> (on average, <span class="math inline">\(\lambda\)</span> individuals enter the portfolio each year). A new individual entering the population at age <span class="math inline">\(a\)</span> given by a uniform variable on <span class="math inline">\([65,70]\)</span>, and is in risk class 1 with probability <span class="math inline">\(p\)</span>.</p>
<p>In the presence of events of type <code>entry</code>, the population must have a characteristic named <code>entry</code>, initially set to <code>NA</code> by default (see function ‘?population’).
When an individual enters the population, his characteristic <code>entry</code> is set to the date <span class="math inline">\(t\)</span> at which he enters the population.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span><span class="op">$</span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">entry_event</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mk_event_poisson.html">mk_event_poisson</a></span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="st">"entry"</span>,</span>
<span>    intensity <span class="op">=</span> <span class="st">"lambda"</span>,</span>
<span>    kernel_code <span class="op">=</span> <span class="st">"if (CUnif()&lt;p)</span></span>
<span><span class="st">                        newI.risk_cls =1;</span></span>
<span><span class="st">                   else</span></span>
<span><span class="st">                        newI.risk_cls= 2;</span></span>
<span><span class="st">                   double a = CUnif(65,70);</span></span>
<span><span class="st">                   newI.set_age(a,t);</span></span>
<span><span class="st">                   newI.out = false;"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<!--```{remark}-->
<p>Note that entries can also occur at a rate <span class="math inline">\(\lambda(t)\)</span> depending on time. For more details, see documentation of <code>?mk_event_poisson_inhomogeneous</code>.
<!--```--></p>
</div>
</div>
<div class="section level2" number="5">
<h2 id="model-creation">
<span class="header-section-number">5</span> Model creation<a class="anchor" aria-label="anchor" href="#model-creation"></a>
</h2>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mk_model.html">mk_model</a></span><span class="op">(</span></span>
<span>    characteristics <span class="op">=</span> <span class="fu"><a href="../reference/get_characteristics.html">get_characteristics</a></span><span class="op">(</span><span class="va">pop_init</span><span class="op">)</span>, <span class="co"># Characteristics names and types</span></span>
<span>    events <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">death_event</span>,<span class="va">entry_event</span>, <span class="va">exit_event</span><span class="op">)</span>, <span class="co"># Events list</span></span>
<span>    parameters <span class="op">=</span> <span class="va">params</span> <span class="co"># Model parameters</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="co">## Events description:</span></span>
<span><span class="co">## [[1]]    </span></span>
<span><span class="co">## Event class : individual </span></span>
<span><span class="co">## Event type : death </span></span>
<span><span class="co">## Event name : death</span></span>
<span><span class="co">## Intensity code : 'result = alpha[I.risk_cls-1] * death_male(t,age(I, t));' </span></span>
<span><span class="co">## Kernel code : '' </span></span>
<span><span class="co">## [[2]]    </span></span>
<span><span class="co">## Event class : poisson </span></span>
<span><span class="co">## Event type : entry </span></span>
<span><span class="co">## Event name : entry</span></span>
<span><span class="co">## Intensity code : 'lambda' </span></span>
<span><span class="co">## Kernel code : 'if (CUnif()&lt;p)</span></span>
<span><span class="co">##                         newI.risk_cls =1;</span></span>
<span><span class="co">##                    else</span></span>
<span><span class="co">##                         newI.risk_cls= 2;</span></span>
<span><span class="co">##                    double a = CUnif(65,70);</span></span>
<span><span class="co">##                    newI.set_age(a,t);</span></span>
<span><span class="co">##                    newI.out = false;' </span></span>
<span><span class="co">## [[3]]    </span></span>
<span><span class="co">## Event class : individual </span></span>
<span><span class="co">## Event type : exit </span></span>
<span><span class="co">## Event name : exit</span></span>
<span><span class="co">## Intensity code : 'result = mu[I.risk_cls-1]; ' </span></span>
<span><span class="co">## Kernel code : '' </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## --------------------------------------- </span></span>
<span><span class="co">## Individual description:</span></span>
<span><span class="co">## names:  birth death risk_cls entry out </span></span>
<span><span class="co">## R types:  double double integer double logical </span></span>
<span><span class="co">## C types:  double double int double bool </span></span>
<span><span class="co">## --------------------------------------- </span></span>
<span><span class="co">## R parameters available in C++ code:</span></span>
<span><span class="co">## names:  death_male alpha mu lambda p </span></span>
<span><span class="co">## R types:  closure vector vector double double </span></span>
<span><span class="co">## C types:  function_xy arma::vec arma::vec double double</span></span></code></pre></div>
</div>
<div class="section level2" number="6">
<h2 id="simulation">
<span class="header-section-number">6</span> Simulation<a class="anchor" aria-label="anchor" href="#simulation"></a>
</h2>
<div class="section level3" number="6.1">
<h3 id="computation-of-event-intensity-bounds">
<span class="header-section-number">6.1</span> Computation of event intensity bounds<a class="anchor" aria-label="anchor" href="#computation-of-event-intensity-bounds"></a>
</h3>
<p>For events with Poisson (constant) intensity, the bound is simply the intensity.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">death_max</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">d_k</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" number="6.2">
<h3 id="simulation-1">
<span class="header-section-number">6.2</span> Simulation<a class="anchor" aria-label="anchor" href="#simulation-1"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/popsim.html">popsim</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">model</span>,</span>
<span>    initial_population <span class="op">=</span> <span class="va">pop_init</span>,</span>
<span>    events_bounds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'death'</span> <span class="op">=</span> <span class="va">death_max</span>, <span class="st">"entry"</span><span class="op">=</span><span class="va">params</span><span class="op">$</span><span class="va">lambda</span>, <span class="st">"exit"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">mu</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    parameters <span class="op">=</span> <span class="va">params</span>,</span>
<span>    time <span class="op">=</span> <span class="va">t</span>,</span>
<span>    age_max <span class="op">=</span> <span class="fl">110</span>,</span>
<span>    multithreading <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><strong>Ratio of accepted events</strong></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_out</span><span class="op">$</span><span class="va">logs</span><span class="op">[[</span><span class="st">"effective_events"</span><span class="op">]</span><span class="op">]</span> <span class="op">/</span> <span class="va">sim_out</span><span class="op">$</span><span class="va">logs</span><span class="op">[[</span><span class="st">"proposed_events"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">## [1] 0.2507238</span></span></code></pre></div>
</div>
</div>
<div class="section level2" number="7">
<h2 id="outputs">
<span class="header-section-number">7</span> Outputs<a class="anchor" aria-label="anchor" href="#outputs"></a>
</h2>
<p>The output population <code>sim_out$population</code> is composed of all individuals present in the portfolio over the period <span class="math inline">\([0, t]\)</span> (individuals in the initial population and those who entered the portfolio). Each line corresponds to an individual, with his date of birth, date of death (<code>NA</code> if still alive at the end of the simulation), risk class, and the characteristic <code>out</code>.
The characteristics <code>out</code> is set to <code>TRUE</code> for individuals who left the portfolio due to an exit event.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">sim_out</span><span class="op">$</span><span class="va">population</span><span class="op">)</span></span>
<span><span class="co">## Classes 'population' and 'data.frame':   929184 obs. of  5 variables:</span></span>
<span><span class="co">##  $ birth   : num  -65 -65 -65 -65 -65 -65 -65 -65 -65 -65 ...</span></span>
<span><span class="co">##  $ death   : num  NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">##  $ risk_cls: int  1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##  $ entry   : num  NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">##  $ out     : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span></code></pre></div>
<p>The function <code><a href="../reference/age_pyramid.html">?age_pyramid</a></code> computes the age pyramid of a population at a given time.</p>
<div class="section level3" number="7.1">
<h3 id="age-pyramids">
<span class="header-section-number">7.1</span> Age pyramids<a class="anchor" aria-label="anchor" href="#age-pyramids"></a>
</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age_grp</span> <span class="op">&lt;-</span> <span class="fl">65</span><span class="op">:</span><span class="fl">98</span></span>
<span><span class="va">pyr</span> <span class="op">=</span> <span class="fu"><a href="../reference/age_pyramid.html">age_pyramid</a></span><span class="op">(</span><span class="va">sim_out</span><span class="op">$</span><span class="va">population</span>, time <span class="op">=</span> <span class="fl">30</span>, ages<span class="op">=</span><span class="va">age_grp</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pyr</span>, age_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">age_grp</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>,by<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<p><img src="insur_pyramid-1.png" width="70%" style="display: block; margin: auto;"></p>
</div>
<p>In order to visualize both risk classes on the same age pyramid with <code><a href="../reference/plot.pyramid.html">?plot.pyramid</a></code> a column <code>group_name</code> containing the individuals risk classes must be added to the age pyramid, and the colors representing each subgroup have to be specified.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pyr</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">&lt;-</span> <span class="st">"group_name"</span></span>
<span><span class="va">pyr</span><span class="op">$</span><span class="va">group_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">pyr</span><span class="op">$</span><span class="va">group_name</span><span class="op">)</span></span>
<span><span class="va">colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span><span class="op">=</span><span class="st">"#00AFBB"</span>,<span class="st">"2"</span><span class="op">=</span><span class="st">"#FC4E07"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pyr</span>,<span class="va">colors</span>,age_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">age_grp</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>,by<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<p><img src="insur_pyr_group-1.png" width="70%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level3" number="7.2">
<h3 id="life-tables">
<span class="header-section-number">7.2</span> Life tables<a class="anchor" aria-label="anchor" href="#life-tables"></a>
</h3>
<p>Death and exposure tables can be computed from the simulation, taking into account the censoring due to exit events.
Note that when individuals enter the population at different ages, the functions <code><a href="../reference/death_table.html">?death_table</a></code> and <code><a href="../reference/exposure_table.html">?exposure_table</a></code> do not take into account this right censoring.</p>
<div class="section level4" number="7.2.1">
<h4 id="risk-class-1">
<span class="header-section-number">7.2.1</span> Risk class 1<a class="anchor" aria-label="anchor" href="#risk-class-1"></a>
</h4>
<p>Death and exposure data can be computed from the simulated portfolio. Below is an example with individuals in risk class 1. A Lee-Carter model is reestimated from the simulated data, and compared with the initial forecast.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age_grp</span> <span class="op">&lt;-</span> <span class="fl">65</span><span class="op">:</span><span class="fl">95</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Dx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/death_table.html">death_table</a></span><span class="op">(</span><span class="va">sim_out</span><span class="op">$</span><span class="va">population</span><span class="op">[</span><span class="va">sim_out</span><span class="op">$</span><span class="va">population</span><span class="op">$</span><span class="va">risk_cls</span><span class="op">==</span><span class="fl">1</span>,<span class="op">]</span>,</span>
<span>                  ages <span class="op">=</span> <span class="va">age_grp</span>, period <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">Ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/exposure_table.html">exposure_table</a></span><span class="op">(</span><span class="va">sim_out</span><span class="op">$</span><span class="va">population</span><span class="op">[</span><span class="va">sim_out</span><span class="op">$</span><span class="va">population</span><span class="op">$</span><span class="va">risk_cls</span><span class="op">==</span><span class="fl">1</span>,<span class="op">]</span>,</span>
<span>                     ages <span class="op">=</span> <span class="va">age_grp</span>, period <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">LC</span> <span class="op">&lt;-</span> <span class="fu">lc</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">LCfitSim1</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">LC</span>, Dxt <span class="op">=</span> <span class="va">Dx</span> , Ext <span class="op">=</span> <span class="va">Ex</span>,ages<span class="op">=</span><span class="va">age_grp</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">age_grp</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<p><img src="insur_LeeCarter_risk1-1.png" width="70%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level4" number="7.2.2">
<h4 id="global-portfolio">
<span class="header-section-number">7.2.2</span> Global portfolio<a class="anchor" aria-label="anchor" href="#global-portfolio"></a>
</h4>
<p>Due to the mortality differential between risk class 1 and 2, there should be more individuals in risk class 2 at higher ages.
However, due to exit events, more individuals in risk class 1 exit the portfolio over time, leading to a higher proportion of individuals in risk class 1 at higher ages than expected when there are no exit events. Thus, mortality rates are closer to mortality rates in risk class 1 at higher ages.</p>
<p><strong>Computation of central mortality rates</strong></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Dx_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/death_table.html">death_table</a></span><span class="op">(</span><span class="va">sim_out</span><span class="op">$</span><span class="va">population</span>, ages <span class="op">=</span> <span class="va">age_grp</span>, period <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">Ex_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/exposure_table.html">exposure_table</a></span><span class="op">(</span><span class="va">sim_out</span><span class="op">$</span><span class="va">population</span>, ages <span class="op">=</span> <span class="va">age_grp</span>, period <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">mx_pop</span> <span class="op">&lt;-</span> <span class="va">Dx_pop</span><span class="op">/</span><span class="va">Ex_pop</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<p><img src="insur_mortality_rates-1.png" width="70%" style="display: block; margin: auto;"></p>
</div>
<p><strong>Evolution of portfolio mortality rates over time</strong></p>
<p>The decrease in mortality rates is slower in the portfolio than in the global population due to composition changes.</p>
<div class="figure" style="text-align: center">
<p><img src="insur_evol_mortality-1.png" width="70%" style="display: block; margin: auto;"></p>
</div>
<p><strong>Cohort mortality rates</strong></p>
<div class="figure" style="text-align: center">
<p><img src="insur_cohort-1.png" width="70%" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
</div>
<div class="section level2" number="8">
<h2 id="different-simulations-with-the-same-model">
<span class="header-section-number">8</span> Different simulations with the same model<a class="anchor" aria-label="anchor" href="#different-simulations-with-the-same-model"></a>
</h2>
<p>The initial population and model parameters can be modified without have to recompile the model, in order to simulate the population model with different input. The event bounds must be modified accordingly before running again the simulation.</p>
<p>An event can also be deactivated by setting the event bound to 0.</p>
<p>See <code><a href="../articles/IBMPopSim_human_pop.html">vignette('IBMPopSim_human_pop')</a></code> for several examples.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Daphné Giorgi, Sarah Kaakai, Vincent Lemaire.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>

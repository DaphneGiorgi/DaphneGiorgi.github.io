<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Creates Poisson class event. — mk_event_poisson • IBMPopSim</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Creates Poisson class event. — mk_event_poisson"><meta property="og:description" content="The function mk_event_poisson is used to create an event with intensity of type Poisson (constant intensity which does not depend on population or time).
When the event occurs, something happens in the population.
The created event must be used with mk_model."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">IBMPopSim</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/IBMPopSim.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/IBMPopSim_cpp.html">C++ essentials</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/IBMPopSim_human_pop.html">Human population</a>
    </li>
    <li>
      <a href="../articles/IBMPopSim_human_pop_IMD.html">Human population with swap</a>
    </li>
    <li>
      <a href="../articles/IBMPopSim_insurance_portfolio.html">Insurance portfolio</a>
    </li>
    <li>
      <a href="../articles/IBMPopSim_interaction.html">Population with genetically variable traits</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/DaphneGiorgi/IBMPopSim/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Creates Poisson class event.</h1>
    <small class="dont-index">Source: <a href="https://github.com/DaphneGiorgi/IBMPopSim/blob/HEAD/R/events.R" class="external-link"><code>R/events.R</code></a></small>
    <div class="hidden name"><code>mk_event_poisson.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The function <code>mk_event_poisson</code> is used to create an event with intensity of type Poisson (constant intensity which does not depend on population or time).
When the event occurs, something happens in the population.
The created event must be used with <code><a href="mk_model.html">mk_model</a></code>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">mk_event_poisson</span><span class="op">(</span><span class="va">type</span>, <span class="va">name</span>, <span class="va">intensity</span>, kernel_code <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>type</dt>
<dd><p>Must be one of <code>'birth'</code>, <code>'death'</code>, <code>'entry'</code>, <code>'exit'</code>, <code>'swap'</code> or <code>'custom'</code>. See details.</p></dd>


<dt>name</dt>
<dd><p><em>(Optional)</em> If not specified, the name given to the event is its type.</p></dd>


<dt>intensity</dt>
<dd><p>String containing some constant positive value, or name of a parameter which is a constant positive value.</p></dd>


<dt>kernel_code</dt>
<dd><p>String containing some C++ code describing the event action. Optional for <code>'birth'</code>, <code>'death'</code> and <code>'exit'</code> events. See details.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>An S3 object of class <code>event</code> of type Poisson.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The <code>type</code> argument is one of the following</p><dl><dt><code>'birth'</code></dt>
<dd><p>By default, a new individual <code>newI</code> is created, with the same characteristics of the parent <code>I</code> and birth date equal to the current time. Optional code can be precised in <code>kernel_code</code>.</p></dd>

<dt><code>'death'</code></dt>
<dd><p>By default, the individual <code>I</code> dies. Optional code can be precised in <code>kernel_code</code>.</p></dd>

<dt><code>'entry'</code></dt>
<dd><p>A new individual <code>newI</code> is added to the population, and its characteristics have to be defined by the user in the entry <code>kernel_code</code>.</p></dd>

<dt><code>'exit'</code></dt>
<dd><p>An individual <code>I</code> exits from the population. Optional code can be precised in <code>kernel_code</code>.</p></dd>

<dt><code>'swap'</code></dt>
<dd><p>The user can change the characteristics of the selected individual <code>I</code>. This requires <code>kernel_code</code>.</p></dd>

<dt><code>'custom'</code></dt>
<dd><p>None of the above types, the user defines <code>kernel_code</code> that can act on the selected individual <code>I</code> and on the population <code>pop</code>.</p></dd>


</dl><p>The <code>kernel_code</code> argument is a string containing some C++ code which describing the action of the event. Some of available variables in the C++ code are: <code>t</code> (the current time), <code>pop</code> (the current population), <code>I</code> (the current individual selected for the event), <code>newI</code> (the new individual if <code>'birth'</code> or <code>'entry'</code> event), the name of the model parameters (some variables, or functions, see <code><a href="mk_model.html">mk_model</a></code>).
See <code><a href="../articles/IBMPopSim.html">vignette('IBMPopSim')</a></code> for more details.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>See also <code><a href="mk_model.html">mk_model</a></code>, <code><a href="mk_event_inhomogeneous_poisson.html">mk_event_inhomogeneous_poisson</a></code>, <code><a href="mk_event_individual.html">mk_event_individual</a></code>, <code><a href="mk_event_interaction.html">mk_event_interaction</a></code>.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">birth</span> <span class="op">&lt;-</span> <span class="fu">mk_event_poisson</span><span class="op">(</span><span class="st">'birth'</span>, intensity <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">death</span> <span class="op">&lt;-</span> <span class="fu">mk_event_poisson</span><span class="op">(</span><span class="st">'death'</span>, intensity <span class="op">=</span> <span class="st">'beta'</span><span class="op">)</span> <span class="co"># name of one parameter</span></span></span>
<span class="r-in"><span><span class="fu"><a href="mk_model.html">mk_model</a></span><span class="op">(</span>events <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">birth</span>, <span class="va">death</span><span class="op">)</span>, parameters <span class="op">=</span> <span class="va">params</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $individual_type</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $individual_type$names</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "birth" "death"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $individual_type$typesR</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "double" "double"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $individual_type$typesC</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "double" "double"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $parameters_types</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $parameters_types$names</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "beta"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $parameters_types$typesR</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "double"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $parameters_types$typesC</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "double"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $parameters_types$lengths</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> beta </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $events</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $events[[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $name</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "birth"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $type</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "poisson" "birth"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $intensity_code</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "10"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $kernel_code</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] ""</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $cpp_code</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "// Event \"birth\"\nstruct event_J_ : public event {\n    double __lambda(unsigned _k, population const &amp; pop, double t, context &amp; cntxt) const {\n        double result = cntxt.__intensity_bound[_J_];\n        return result;\n    }\n    double __lambda_bound(population const &amp; pop, context &amp; cntxt) const {\n        double result = cntxt.__intensity_bound[_J_] / cntxt.__num_threads;\n        return result;\n    }\n    void __kernel(unsigned _k, population &amp; pop, double t, context &amp; cntxt) const {\n        individual &amp; I = pop[_k];\n        individual newI = I;\n\tnewI.birth_date = t;\n\t_CORRECTION_IF_ENTRY_\n\t\n\tpop.add(newI);\n    }\n    bool __apply(double t, population &amp; pop, context &amp; cntxt) const {\n        unsigned _k = pop.pick_alive(t, cntxt);\n        __kernel(_k, pop, t, cntxt);\n        return true;\n    }\n};\n"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "event"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $events[[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $name</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "death"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $type</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "poisson" "death"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $intensity_code</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "beta"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $kernel_code</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] ""</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $cpp_code</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "// Event \"death\"\nstruct event_J_ : public event {\n    double __lambda(unsigned _k, population const &amp; pop, double t, context &amp; cntxt) const {\n        double result = cntxt.__intensity_bound[_J_];\n        return result;\n    }\n    double __lambda_bound(population const &amp; pop, context &amp; cntxt) const {\n        double result = cntxt.__intensity_bound[_J_] / cntxt.__num_threads;\n        return result;\n    }\n    void __kernel(unsigned _k, population &amp; pop, double t, context &amp; cntxt) const {\n        individual &amp; I = pop[_k];\n        \n\tpop.kill(_k, t);\n    }\n    bool __apply(double t, population &amp; pop, context &amp; cntxt) const {\n        unsigned _k = pop.pick_alive(t, cntxt);\n        __kernel(_k, pop, t, cntxt);\n        return true;\n    }\n};\n"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "event"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $cpp_code</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "// -*- coding: utf-8 -*-\n//[[Rcpp::depends(IBMPopSim)]]\n//[[Rcpp::depends(RcppArmadillo)]]\n//[[Rcpp::plugins(cpp11)]]\n#include &lt;RcppArmadillo.h&gt;\n#include &lt;cmath&gt;\n#include &lt;limits&gt;\n#include &lt;array&gt;\n#include &lt;vector&gt;\n#include &lt;string&gt;\n#include &lt;thread&gt;\n#include &lt;chrono&gt;\n\n#include \"functions.hpp\"\n\n// ***** DECLARATION_INDIVIDUAL\nstruct  individual{\n    individual() : death_date(NAN){}\n    individual(double birth_date,  double death_date = NAN)\n        : birth_date(birth_date),  death_date(death_date) { }\n    double birth_date;\n\n    // **** caracteristiques supplémentaires\n\n    // ****\n\n    double death_date; // If not dead, death_date = nan\n    double age(double t) const { return t - birth_date; };\n    void set_age(double a, double t) { birth_date = t-a; };\n    bool is_dead() const {return !std::isnan(death_date); };\n};\n\ninline double age(individual const &amp; I, double t) { return I.age(t); }\n\n// *****\n\n// ***** DECLARATION_PARAMS MK_CONTEXT\nstruct context {\n    std::mt19937_64 __gen;\n    int __num_threads;\n    std::vector&lt;double&gt; __intensity_bound;\n\tdouble beta;\n#define beta cntxt.beta\n\n\n    template&lt;typename ... Args&gt;\n    double Unif(Args&amp;&amp;... arg) { return std::uniform_real_distribution&lt;double&gt;(std::forward&lt;Args&gt;(arg)...)(__gen); }\n#define CUnif cntxt.Unif\n    template&lt;typename ... Args&gt;\n    double Exp(Args&amp;&amp;... arg) { return std::exponential_distribution&lt;double&gt;(std::forward&lt;Args&gt;(arg)...)(__gen); }\n#define CExp  cntxt.Exp\n    template&lt;typename ... Args&gt;\n    double Norm(Args&amp;&amp;... arg) { return std::normal_distribution&lt;double&gt;(std::forward&lt;Args&gt;(arg)...)(__gen); }\n#define CNorm cntxt.Norm\n    template&lt;typename ... Args&gt;\n    unsigned Poisson(Args&amp;&amp;... arg) { return std::poisson_distribution&lt;&gt;(std::forward&lt;Args&gt;(arg)...)(__gen); }\n#define CPoisson cntxt.Poisson\n    template&lt;typename ... Args&gt;\n    double Gamma(Args&amp;&amp;... arg) { return std::gamma_distribution&lt;double&gt;(std::forward&lt;Args&gt;(arg)...)(__gen); }\n#define CGamma cntxt.Gamma\n    template&lt;typename ... Args&gt;\n    double Weibull(Args&amp;&amp;... arg) { return std::weibull_distribution&lt;double&gt;(std::forward&lt;Args&gt;(arg)...)(__gen); }\n#define CWeibull cntxt.Weibull\n    template&lt;typename ... Args&gt;\n    int UnifInt(Args&amp;&amp;... arg) { return std::uniform_int_distribution&lt;int&gt;(std::forward&lt;Args&gt;(arg)...)(__gen); }\n#define CUnifInt  cntxt.UnifInt\n    template&lt;typename ... Args&gt;\n    unsigned Discrete(Args&amp;&amp;... arg) { return std::discrete_distribution&lt;int&gt;(std::forward&lt;Args&gt;(arg)...)(__gen); }\n#define CDiscrete  cntxt.Discrete\n    template&lt;typename ... Args&gt;\n    bool Bernoulli(Args&amp;&amp;... arg) { return std::bernoulli_distribution(std::forward&lt;Args&gt;(arg)...)(__gen); }\n#define CBern  cntxt.Bernoulli\n    template&lt;typename ... Args&gt;\n    unsigned Binomial(Args&amp;&amp;... arg) { return std::binomial_distribution&lt;int&gt;(std::forward&lt;Args&gt;(arg)...)(__gen); }\n#define CBinom  cntxt.Binomial\n};\n// *****\n\n#include \"population.hpp\"\n\n// ***** DEFINITION_EVENTS\nstruct event {\n    virtual double __lambda(unsigned k, population const &amp; pop, double t, context &amp; cntxt) const = 0;\n    virtual double __lambda_bound(population const &amp; pop, context &amp; cntxt) const = 0;\n    virtual void __kernel(unsigned k, population &amp; pop, double t, context &amp; cntxt) const = 0;\n    virtual bool __apply(double t, population &amp; pop, context &amp; cntxt) const = 0;\n};\n\nconstexpr int NEVENTS = 2;\n// Event \"birth\"\nstruct event0 : public event {\n    double __lambda(unsigned _k, population const &amp; pop, double t, context &amp; cntxt) const {\n        double result = cntxt.__intensity_bound[0];\n        return result;\n    }\n    double __lambda_bound(population const &amp; pop, context &amp; cntxt) const {\n        double result = cntxt.__intensity_bound[0] / cntxt.__num_threads;\n        return result;\n    }\n    void __kernel(unsigned _k, population &amp; pop, double t, context &amp; cntxt) const {\n        individual &amp; I = pop[_k];\n        individual newI = I;\n\tnewI.birth_date = t;\n\t\n\t\n\tpop.add(newI);\n    }\n    bool __apply(double t, population &amp; pop, context &amp; cntxt) const {\n        unsigned _k = pop.pick_alive(t, cntxt);\n        __kernel(_k, pop, t, cntxt);\n        return true;\n    }\n};\n// Event \"death\"\nstruct event1 : public event {\n    double __lambda(unsigned _k, population const &amp; pop, double t, context &amp; cntxt) const {\n        double result = cntxt.__intensity_bound[1];\n        return result;\n    }\n    double __lambda_bound(population const &amp; pop, context &amp; cntxt) const {\n        double result = cntxt.__intensity_bound[1] / cntxt.__num_threads;\n        return result;\n    }\n    void __kernel(unsigned _k, population &amp; pop, double t, context &amp; cntxt) const {\n        individual &amp; I = pop[_k];\n        \n\tpop.kill(_k, t);\n    }\n    bool __apply(double t, population &amp; pop, context &amp; cntxt) const {\n        unsigned _k = pop.pick_alive(t, cntxt);\n        __kernel(_k, pop, t, cntxt);\n        return true;\n    }\n};\nstd::array&lt;event*, NEVENTS&gt; events { new event0, new event1 };\n// *****\n\n#include \"popsim_algorithm.hpp\"\n\nusing namespace Rcpp;\n\n//' @param pop_df Dataframe representing the initial population\n//' @param events_bounds NumericVector containing the events bounds\n//' @param parameters R parameters and functions available in C++ code\n//' @param age_max Age max of the population\n//' @param T0 Initial time\n//' @param T Final time\n//' @param clean_step Clean step for cleaning population from dead (or exit) individuals, by default equal to population age max\n//' @param clean_ratio Ratio of dead (or exit) individuals in the population for cleaning population from dead (or exit) individuals\n//' @param seed Seed for the random number generator\n//' @param multithreading Boolean for multithread activation, by default multithread is deactivated\n//' @param num_threads Number of threads for multithread run, if multihtread is activated the default value is the maximum of threads\n//' @param verbose verbose by default false\n//'\n//' @export\n// [[Rcpp::export]]\nRcpp::List popsim_cpp(Rcpp::DataFrame pop_df,\n        Rcpp::NumericVector events_bounds,\n        Rcpp::List parameters,\n        double age_max, double T0, double T,\n        double clean_step, double clean_ratio,\n        int seed,\n        bool multithreading, int num_threads = NA_INTEGER,\n        bool verbose = false)\n{\n    std::vector&lt;double&gt; intensity_bound = Rcpp::as&lt;std::vector&lt;double&gt;&gt;(events_bounds);\n    population pop(age_max);\n\n    if (verbose)\n        Rcpp::Rcout &lt;&lt; \"Simulation on the interval [\" &lt;&lt; T0 &lt;&lt; \", \" &lt;&lt; T &lt;&lt; \"] \" &lt;&lt; std::endl;\n    if (multithreading) {\n#ifdef __INTERACTION\n        Rcpp::Rcout &lt;&lt; \"Warning: Multithreading should be deactivated...\" &lt;&lt; std::endl;\n#endif\n        if (num_threads == NA_INTEGER) {\n            num_threads = std::thread::hardware_concurrency();\n        }\n        if (verbose) Rcpp::Rcout &lt;&lt; \"Multithreading activated with \" &lt;&lt; num_threads &lt;&lt; \" threads\" &lt;&lt; std::endl;\n    } else {\n        if (verbose) Rcpp::Rcout &lt;&lt; \"Multithreading deactivated\" &lt;&lt; std::endl;\n        num_threads = 1;\n    }\n\n    if (verbose) Rcpp::Rcout &lt;&lt; \"Seed: \" &lt;&lt; seed &lt;&lt; std::endl;\n    std::vector&lt;uint32_t&gt; seeds(2*num_threads);\n    std::seed_seq seq { seed };\n    seq.generate(seeds.begin(), seeds.end());\n\n    // ***** INITIALISATION_POPULATION\n    Rcpp::DoubleVector _birth_date = pop_df[\"birth\"];\n\tRcpp::DoubleVector _death_date = pop_df[\"death\"];\n\tfor (unsigned _k = 0; _k &lt; pop_df.nrow(); ++_k)\n\t    pop.add_init(individual(_birth_date[_k], _death_date[_k]));\n\t\n    // *****\n\n    // ***** DEFINITION_PARAMETERS\n    context cntxt {\n        std::mt19937_64(),\n        num_threads,\n        intensity_bound,\n        Rcpp::as&lt;double&gt;(parameters[\"beta\"])\n\t\t\n    };\n    // *****\n\n    std::vector&lt;std::thread&gt; threads(num_threads);\n    std::vector&lt;counter&gt; counters(num_threads);\n    std::vector&lt;population&gt; pops = split(pop, num_threads);\n\n    if (verbose) {\n        std::cout &lt;&lt; \"before main algorithm \\t\" &lt;&lt; std::endl;\n        std::cout &lt;&lt; \"parameters age max \" &lt;&lt; age_max  &lt;&lt; std::endl;\n        std::cout &lt;&lt; \"parameters clean_step \" &lt;&lt; clean_step  &lt;&lt; std::endl;\n        std::cout &lt;&lt; \"parameters clean_ratio \" &lt;&lt; clean_ratio  &lt;&lt; std::endl;\n        std::cout &lt;&lt; \"parameters num_threads \" &lt;&lt; num_threads  &lt;&lt; std::endl;\n    }\n    auto start = std::chrono::system_clock::now();\n    // Main algorithm\n    for (unsigned k = 0; k &lt; num_threads; ++k) {\n        cntxt.__gen.seed(static_cast&lt;uint64_t&gt;(seeds[2*k]) &lt;&lt; 32 | seeds[2*k+1]);\n        auto &amp; counter_k = counters[k];\n        auto &amp; pop_k = pops[k];\n        if (verbose) std::cout &lt;&lt; pop_k.individuals.size() &lt;&lt; std::endl;\n\n        threads[k] = std::thread(\n                [=, &amp;pop_k, &amp;counter_k]() mutable {\n                counter_k = popsim_algorithm(pop_k, cntxt, events,\n                        T0, T, clean_step, clean_ratio);\n                });\n    }\n    for (auto &amp; th : threads) th.join();\n    auto end = std::chrono::system_clock::now();\n    auto elapsed_seconds = end-start;\n    double secs_main_algorithm = elapsed_seconds.count();\n\n    pop = merge(pops);\n    counter C {0, 0, 0 };\n    for (auto &amp; Cs : counters) C += Cs;\n\n    // ***** OUTPUT_POPULATION\n    if (verbose) std::cout &lt;&lt; \"Before output conversion \" &lt;&lt; std::endl;\n\tstd::vector&lt;double&gt; _birth_date_out;\n\t_birth_date_out.reserve(pop.individuals.size()+pop.dead_individuals.size());\n\tstd::vector&lt;double&gt; _death_date_out;\n\t_death_date_out.reserve(pop.individuals.size()+pop.dead_individuals.size());\n\tif (verbose) std::cout &lt;&lt; \"individuals size : \" &lt;&lt; pop.individuals.size() &lt;&lt; std::endl;\n\tfor (unsigned _k = 0; _k &lt; pop.individuals.size(); ++_k) {\n\t    _birth_date_out.push_back( pop.individuals[_k].birth_date );\n\t    _death_date_out.push_back( pop.individuals[_k].death_date );\n\t    }\n\tif (verbose) std::cout &lt;&lt; \"dead_individuals size : \" &lt;&lt; pop.dead_individuals.size() &lt;&lt; std::endl;\n\tfor (unsigned _k = 0; _k &lt; pop.dead_individuals.size(); ++_k) {\n\t    _birth_date_out.push_back( pop.dead_individuals[_k].birth_date );\n\t    _death_date_out.push_back( pop.dead_individuals[_k].death_date );\n\t    }\n\tRcpp::DataFrame new_pop_df = Rcpp::DataFrame::create(\n\t    Rcpp::Named(\"birth\") = _birth_date_out,\n\t    Rcpp::Named(\"death\") = _death_date_out);\n\tif (verbose) std::cout &lt;&lt; \"After output conversion \" &lt;&lt; std::endl;\n\t\n    // *****\n\n    Rcpp::NumericVector logs = Rcpp::NumericVector::create(\n            Rcpp::Named(\"proposed_events\")= C.proposedEvents,\n            Rcpp::Named(\"effective_events\")= C.effectiveEvents,\n            Rcpp::Named(\"cleanall_counter\")= C.cleanAll,\n            Rcpp::Named(\"duration_main_algorithm\")=secs_main_algorithm);\n    // Returns population and simulation info\n    Rcpp::List L = Rcpp::List::create(\n            Rcpp::Named(\"population\") = new_pop_df,\n            Rcpp::Named(\"logs\") = logs);\n    return L;\n};\n"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $sourceCpp</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $sourceCpp$functions</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "popsim_cpp"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $sourceCpp$modules</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> character(0)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $sourceCpp$cppSourcePath</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "/tmp/Rtmp0wvX9Z/sourceCpp-x86_64-pc-linux-gnu-1.0.9/file27266bfda486.cpp"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $sourceCpp$buildDirectory</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "/tmp/Rtmp0wvX9Z/sourceCpp-x86_64-pc-linux-gnu-1.0.9/sourcecpp_27267c9d8005"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $popsim_cpp</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (pop_df, events_bounds, parameters, age_max, T0, T, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     clean_step, clean_ratio, seed, multithreading, num_threads = NA_integer_, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     verbose = FALSE) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> .Call(&lt;pointer: 0x7f05683ddbd0&gt;, pop_df, events_bounds, parameters, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     age_max, T0, T, clean_step, clean_ratio, seed, multithreading, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     num_threads, verbose)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "model"</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Daphné Giorgi, Sarah Kaakai, Vincent Lemaire.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

